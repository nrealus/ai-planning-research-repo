
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../reasoner/">
      
      
        <link rel="next" href="../diff_reasoner/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.8">
    
    
      
        <title>SAT Reasoner - AI Planning Research Project</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.046329b4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra_style.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.solver.reasoners.sat_reasoner-attributes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="AI Planning Research Project" class="md-header__button md-logo" aria-label="AI Planning Research Project" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AI Planning Research Project
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SAT Reasoner
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AI Planning Research Project" class="md-nav__button md-logo" aria-label="AI Planning Research Project" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    AI Planning Research Project
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aries-like Solver Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../cdcl_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example CDCL search
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../fundamentals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fundamentals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../constraint_expressions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Constraint Expressions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Solver
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Solver
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../common/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Common
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../solver_state/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solver State
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../solver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solver Main Class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_4" checked>
        
          <label class="md-nav__link" for="__nav_3_3_4" id="__nav_3_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reasoners
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3_4">
            <span class="md-nav__icon md-icon"></span>
            Reasoners
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../reasoner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reasoner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    SAT Reasoner
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    SAT Reasoner
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.MAX_INT" class="md-nav__link">
    MAX_INT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner" class="md-nav__link">
    SATReasoner
  </a>
  
    <nav class="md-nav" aria-label="SATReasoner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.clauses_database" class="md-nav__link">
    clauses_database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.clause_activity_increase" class="md-nav__link">
    clause_activity_increase
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.clause_activity_decay" class="md-nav__link">
    clause_activity_decay
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_fixed_clauses" class="md-nav__link">
    num_fixed_clauses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_learned_clauses" class="md-nav__link">
    num_learned_clauses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_allowed_learned_clauses_before_forgetting" class="md-nav__link">
    num_allowed_learned_clauses_before_forgetting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_allowed_learned_clauses_before_forgetting_first_time" class="md-nav__link">
    num_allowed_learned_clauses_before_forgetting_first_time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.allowed_learned_clauses_ratio" class="md-nav__link">
    allowed_learned_clauses_ratio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_conflicts" class="md-nav__link">
    num_conflicts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_conflicts_at_last_database_expansion" class="md-nav__link">
    num_conflicts_at_last_database_expansion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_conflicts_allowed_before_database_expansion" class="md-nav__link">
    num_conflicts_allowed_before_database_expansion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.database_expansion_ratio" class="md-nav__link">
    database_expansion_ratio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.increase_ratio_of_conflicts_before_db_expansion" class="md-nav__link">
    increase_ratio_of_conflicts_before_db_expansion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.locked_clauses" class="md-nav__link">
    locked_clauses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.locked_clauses_trail" class="md-nav__link">
    locked_clauses_trail
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.watchlists" class="md-nav__link">
    watchlists
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.pending_clauses_info" class="md-nav__link">
    pending_clauses_info
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.next_unprocessed_solver_event_index" class="md-nav__link">
    next_unprocessed_solver_event_index
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.state" class="md-nav__link">
    state
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.Clause" class="md-nav__link">
    Clause
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.ClauseId" class="md-nav__link">
    ClauseId
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.add_new_fixed_clause_with_scope" class="md-nav__link">
    add_new_fixed_clause_with_scope()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.add_new_learned_clause" class="md-nav__link">
    add_new_learned_clause()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.on_solver_increment_one_decision_level" class="md-nav__link">
    on_solver_increment_one_decision_level()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.on_solver_backtrack_one_decision_level" class="md-nav__link">
    on_solver_backtrack_one_decision_level()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.propagate" class="md-nav__link">
    propagate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.explain" class="md-nav__link">
    explain()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../diff_reasoner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Difference Logic Reasoner
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_5" >
        
          <label class="md-nav__link" for="__nav_3_3_5" id="__nav_3_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Branchers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_5">
            <span class="md-nav__icon md-icon"></span>
            Branchers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../brancher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Brancher
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.MAX_INT" class="md-nav__link">
    MAX_INT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner" class="md-nav__link">
    SATReasoner
  </a>
  
    <nav class="md-nav" aria-label="SATReasoner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.clauses_database" class="md-nav__link">
    clauses_database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.clause_activity_increase" class="md-nav__link">
    clause_activity_increase
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.clause_activity_decay" class="md-nav__link">
    clause_activity_decay
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_fixed_clauses" class="md-nav__link">
    num_fixed_clauses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_learned_clauses" class="md-nav__link">
    num_learned_clauses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_allowed_learned_clauses_before_forgetting" class="md-nav__link">
    num_allowed_learned_clauses_before_forgetting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_allowed_learned_clauses_before_forgetting_first_time" class="md-nav__link">
    num_allowed_learned_clauses_before_forgetting_first_time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.allowed_learned_clauses_ratio" class="md-nav__link">
    allowed_learned_clauses_ratio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_conflicts" class="md-nav__link">
    num_conflicts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_conflicts_at_last_database_expansion" class="md-nav__link">
    num_conflicts_at_last_database_expansion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.num_conflicts_allowed_before_database_expansion" class="md-nav__link">
    num_conflicts_allowed_before_database_expansion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.database_expansion_ratio" class="md-nav__link">
    database_expansion_ratio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.increase_ratio_of_conflicts_before_db_expansion" class="md-nav__link">
    increase_ratio_of_conflicts_before_db_expansion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.locked_clauses" class="md-nav__link">
    locked_clauses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.locked_clauses_trail" class="md-nav__link">
    locked_clauses_trail
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.watchlists" class="md-nav__link">
    watchlists
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.pending_clauses_info" class="md-nav__link">
    pending_clauses_info
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.next_unprocessed_solver_event_index" class="md-nav__link">
    next_unprocessed_solver_event_index
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.state" class="md-nav__link">
    state
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.Clause" class="md-nav__link">
    Clause
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.ClauseId" class="md-nav__link">
    ClauseId
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.add_new_fixed_clause_with_scope" class="md-nav__link">
    add_new_fixed_clause_with_scope()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.add_new_learned_clause" class="md-nav__link">
    add_new_learned_clause()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.on_solver_increment_one_decision_level" class="md-nav__link">
    on_solver_increment_one_decision_level()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.on_solver_backtrack_one_decision_level" class="md-nav__link">
    on_solver_backtrack_one_decision_level()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.propagate" class="md-nav__link">
    propagate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.reasoners.sat_reasoner.SATReasoner.explain" class="md-nav__link">
    explain()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>SAT Reasoner</h1>

<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">
  
      <p>This module defines the "SAT reasoner" (aka "disjunctive reasoner") of the solver.</p>
<p>This reasoner acts like a SAT solver.
It maintains a database of clauses and performs unit propagation.</p>
<p>It is the most "basic" reasoner of the solver and is absolutely required,
as clause learning (for CDCL search) would be simply impossible without it.</p>

  

  <div class="doc doc-children">





<h3 id="src.solver.reasoners.sat_reasoner-attributes">Attributes</h3>

<div class="doc doc-object doc-attribute">




<h4 id="src.solver.reasoners.sat_reasoner.MAX_INT" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">MAX_INT</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">64</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  </div>

</div>
<h3 id="src.solver.reasoners.sat_reasoner-classes">Classes</h3>

<div class="doc doc-object doc-class">




<h4 id="src.solver.reasoners.sat_reasoner.SATReasoner" class="doc doc-heading">
          <code>SATReasoner</code>


</h4>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="src.solver.reasoners.reasoner.Reasoner" href="../reasoner/#src.solver.reasoners.reasoner.Reasoner">Reasoner</a></code></p>

  
      <p>Also called "Disjunctive Reasoner". It acts as a SAT solver. It
maintains the database of clauses and performs unit propagation.</p>
<p>In essence, for each clause in the database, we look for distinct 
literals that are not falsified by the current domains:</p>
<ul>
<li>
<p>If all literals are false, the clause is violated and a conflict
is reported, which will cause the search to backtrack.</p>
</li>
<li>
<p>If all but one literal <code>l</code> are false, then the clause is unit
and <code>l</code> is enforced/set.</p>
</li>
<li>
<p>Otherwise, two non-false literals are selected and added to a "watch list".
Once one of these literal is set, the clause will be reevaluated.</p>
</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/solver/reasoners/sat_reasoner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SATReasoner</span><span class="p">(</span><span class="n">Reasoner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Also called &quot;Disjunctive Reasoner&quot;. It acts as a SAT solver. It</span>
<span class="sd">    maintains the database of clauses and performs unit propagation.</span>

<span class="sd">    In essence, for each clause in the database, we look for distinct </span>
<span class="sd">    literals that are not falsified by the current domains:</span>

<span class="sd">    - If all literals are false, the clause is violated and a conflict</span>
<span class="sd">    is reported, which will cause the search to backtrack.</span>

<span class="sd">    - If all but one literal `l` are false, then the clause is unit</span>
<span class="sd">    and `l` is enforced/set.</span>

<span class="sd">    - Otherwise, two non-false literals are selected and added to a &quot;watch list&quot;.</span>
<span class="sd">    Once one of these literal is set, the clause will be reevaluated.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # </span>

    <span class="k">def</span> <span class="nf">_get_literal_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Syntactic sugar around `self.state.is_entailed`.</span>

<span class="sd">        Args:</span>
<span class="sd">            literal: A literal.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if `literal` is true (i.e. currently entailed). False if   \</span>
<span class="sd">                it is false (i.e. its negation is currently entailed).      \</span>
<span class="sd">                None otherwise (i.e. `literal` is unbound: it isn&#39;t yet     \</span>
<span class="sd">                known to be true or false).</span>
<span class="sd">        &quot;&quot;&quot;</span> 

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">literal</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">literal</span><span class="o">.</span><span class="n">negated</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="c1">#############################################################################</span>
    <span class="c1"># CLAUSE ID, CLAUSE DATA </span>
    <span class="c1">#############################################################################</span>

    <span class="nd">@dataclass</span>
    <span class="k">class</span> <span class="nc">Clause</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Keeps the data of a clause registered in the clause database.&quot;&quot;&quot;</span>
        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="n">literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The literals of the clause (without the scope literal).&quot;&quot;&quot;</span>

        <span class="n">scope_literal</span><span class="p">:</span> <span class="n">Lit</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The literal representing the scope in which the clause</span>
<span class="sd">        (or rather its literals&#39; variables) are defined.</span>

<span class="sd">        As such, the true &quot;meaning&quot; of the clause can be expressed with the</span>
<span class="sd">        following disjunction: `(not scope_literal) | l_1 | ... | l_n`.</span>

<span class="sd">        This also means that a clause whose literals are all false is only a</span>
<span class="sd">        conflict when we cannot &quot;get out of&quot; its scope (i.e. make</span>
<span class="sd">        its `scope_literal` False).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="n">learned</span><span class="p">:</span> <span class="nb">bool</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the clause is learned (i.e. resulting from conflict analysis) or not.&quot;&quot;&quot;</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="n">watch1_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Index of the first watched literal of the clause.&quot;&quot;&quot;</span>

        <span class="n">watch2_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Index of the second watched literal of the clause.&quot;&quot;&quot;</span>

        <span class="n">unwatched_indices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of the indices of unwatched literals of the clause.&quot;&quot;&quot;</span>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">watch1</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lit</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">literals</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">watch1_index</span><span class="p">]</span>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">watch2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lit</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">literals</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">watch2_index</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">unwatched</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lit</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">literals</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unwatched_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="n">activity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># lbd: float = field(init=False)</span>
        <span class="c1"># &quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="c1"># &quot;&quot;&quot;</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span>
            <span class="n">scope_literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
            <span class="n">learned</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">literals</span> <span class="o">=</span> <span class="n">literals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scope_literal</span> <span class="o">=</span> <span class="n">scope_literal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">learned</span> <span class="o">=</span> <span class="n">learned</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">activity</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># self.lbd = 0</span>

            <span class="n">len_literals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">literals</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">len_literals</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;Empty clauses are not allowed in the &quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;SAT reasoner / clause database&quot;</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">watch1_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">watch2_index</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">len_literals</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unwatched_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">len_literals</span><span class="p">))</span> <span class="k">if</span> <span class="n">len_literals</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">class</span> <span class="nc">ClauseId</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Represents the ID of a clause in the database.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">SolverState</span><span class="p">,</span>
        <span class="n">clause_activity_increase</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">clause_activity_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.999</span><span class="p">,</span>
        <span class="n">num_allowed_learned_clauses_before_forgetting_first_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">num_allowed_learned_clauses_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">num_conflicts_allowed_before_database_expansion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">database_expansion_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.05</span><span class="p">,</span>
        <span class="n">increase_ratio_of_conflicts_before_db_expansion</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">:</span> <span class="n">SolverState</span> <span class="o">=</span> <span class="n">state</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_clauses_id_counter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">Clause</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The clauses database.&quot;&quot;&quot;</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clause_activity_increase</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">clause_activity_increase</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clause_activity_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">clause_activity_decay</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_fixed_clauses</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_learned_clauses</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># The difference between the number of conflicts</span>
                                            <span class="c1"># and the number of learned clauses is that the</span>
                                            <span class="c1"># number of conflicts never gets smaller, but the</span>
                                            <span class="c1"># number of learned clauses can (when reducing</span>
                                            <span class="c1"># the database / forgetting learned clauses). </span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_allowed_learned_clauses_before_forgetting</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Not initialized yet. &quot;Actual&quot; initial value</span>
                                                                    <span class="c1"># assigned at the first call to `scale_database`,</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_allowed_learned_clauses_before_forgetting_first_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_allowed_learned_clauses_before_forgetting_first_time</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_learned_clauses_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">num_allowed_learned_clauses_ratio</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts_at_last_database_expansion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts_allowed_before_database_expansion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_conflicts_allowed_before_database_expansion</span>
                                                                    <span class="c1"># TODO synchronize with restarts !!!</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">database_expansion_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">database_expansion_ratio</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">increase_ratio_of_conflicts_before_db_expansion</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">increase_ratio_of_conflicts_before_db_expansion</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Contains all locked clauses (locked at all previous decision levels).</span>
<span class="sd">        A clause that is marked as locked cannot be removed from the clause</span>
<span class="sd">        database as part of database rescaling / forgetting of learned clauses.</span>

<span class="sd">        Marking a clause as locked is necessary when that clause may be needed</span>
<span class="sd">        for explanation mechanisms.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses_trail</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[]]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trail of locked clauses. Outer list index: decision level.</span>
<span class="sd">        Inner list content: clauses locked while at that decision level.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">watchlists</span><span class="p">:</span> <span class="n">SetGuardedByLiterals</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]</span> <span class="o">=</span> <span class="n">SetGuardedByLiterals</span><span class="p">()</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Represents literals&#39; &quot;watch lists&quot; (lists of clauses where they appear).</span>

<span class="sd">        Internally, a literal [signed_var &lt;= val]&#39;s watchlist is represented as:</span>
<span class="sd">        { signed_var : { val : [clause1_id, clause2_id, ...] }}</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pending_clauses_info</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Lit</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores clauses that have been recorded to the database,</span>
<span class="sd">        but not processed yet.</span>

<span class="sd">        The first element of the tuple is the ID of the clause to propagate.</span>

<span class="sd">        The second element is either None or a literal that is entailed by</span>
<span class="sd">        the clause at the current decision level. This literal MUST be set</span>
<span class="sd">        to true, with this clause as its cause, even if the clause is not</span>
<span class="sd">        unit.</span>

<span class="sd">        This situation might happen when the clause was learned from</span>
<span class="sd">        a conflict involving eager propagation of optional variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">next_unprocessed_solver_event_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The index of the next unprocessed (i.e. not yet propagated) event</span>
<span class="sd">        in the main solver&#39;s events trail (in the current decision level).</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SolverState</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>

    <span class="c1">#############################################################################</span>
    <span class="c1"># CLAUSE ADDITION / REGISTRATION</span>
    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">add_new_fixed_clause_with_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">clause_literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span>
        <span class="n">scope_literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new non-learned clause to the clauses database</span>
<span class="sd">        and to the pending clauses queue.</span>

<span class="sd">        Args:</span>
<span class="sd">            clause_literals: The literals composing the clause.</span>

<span class="sd">            scope_literal: The literal representing the scope in which  \</span>
<span class="sd">                the clause is defined.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The ID given to the clause after being registered in the clauses database.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">clause_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_new_clause</span><span class="p">(</span><span class="n">clause_literals</span><span class="p">,</span> <span class="n">scope_literal</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pending_clauses_info</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_fixed_clauses</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">add_new_learned_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">asserting_clause_literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span>
        <span class="n">asserted_literal</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Lit</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new learned clause to the clauses database</span>
<span class="sd">        and to the pending clauses queue.</span>

<span class="sd">        Args:</span>
<span class="sd">            clause_literals: The literals composing the clause.</span>

<span class="sd">            scope_literal: The literal representing the scope in which  \</span>
<span class="sd">                the clause is defined.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The ID given to the clause after being registered in the clauses database.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="n">asserted_literal</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">asserted_literal</span> <span class="ow">in</span> <span class="n">asserting_clause_literals</span>

        <span class="n">clause_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_new_clause</span><span class="p">(</span><span class="n">asserting_clause_literals</span><span class="p">,</span> <span class="n">TRUE_LIT</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pending_clauses_info</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">asserted_literal</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_learned_clauses</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_add_new_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">clause_literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span>
        <span class="n">scope_literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
        <span class="n">learned</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new clause to the clauses database.</span>
<span class="sd">        Used by the higher level clause addition functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">clause_id</span> <span class="o">=</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_clauses_id_counter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clauses_id_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">clause_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">Clause</span><span class="p">(</span><span class="n">clause_literals</span><span class="p">,</span>
                                                              <span class="n">scope_literal</span><span class="p">,</span>
                                                              <span class="n">learned</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clause_id</span>

    <span class="c1">#############################################################################</span>
    <span class="c1"># WATCHES (WATCHED LITERALS &amp; WATCHLISTS)</span>
    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">_swap_watch1_and_watch2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">clause_id</span><span class="p">:</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Swaps the 1st and 2nd watched literals of a clause.&quot;&quot;&quot;</span>

        <span class="n">clause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">clause_id</span><span class="p">]</span>

        <span class="n">clause</span><span class="o">.</span><span class="n">watch1_index</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch2_index</span> <span class="o">=</span> \
            <span class="n">clause</span><span class="o">.</span><span class="n">watch2_index</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch1_index</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_swap_watch2_and_unwatched_i</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">clause_id</span><span class="p">:</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span>
        <span class="n">i</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Swaps the 2nd watched literal with the i-th unwatched literal of a clause.&quot;&quot;&quot;</span>

        <span class="n">clause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">clause_id</span><span class="p">]</span>

        <span class="n">clause</span><span class="o">.</span><span class="n">watch2_index</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">unwatched_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">clause</span><span class="o">.</span><span class="n">unwatched_indices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch2_index</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_move_watches_front</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">clause_id</span><span class="p">:</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects the two (unbound) literals that should be watched</span>
<span class="sd">        and make them the watched literals of the clause.</span>

<span class="sd">        After the method completion, the 1st watched literal will have the</span>
<span class="sd">        highest priority and the 2nd watched literal will have the second highest</span>
<span class="sd">        priority. The order of the other (unwatched) literals is undefined.</span>

<span class="sd">        The priority rule ordering (from highest to lowest):</span>
<span class="sd">        - True literals</span>
<span class="sd">        - Undefined literals</span>
<span class="sd">        - False literals, prioritizing those with the highest decision level</span>
<span class="sd">        - Leftmost literal in the original clause (to avoid swapping two literals with the same priority)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">priority_of_lit</span><span class="p">(</span><span class="n">lit</span><span class="p">:</span> <span class="n">Lit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_literal_value</span><span class="p">(</span><span class="n">lit</span><span class="p">):</span>
                <span class="n">case</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">MAX_INT</span>
                <span class="n">case</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">MAX_INT</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">case</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">first_impl_ev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">first_event_entailing</span><span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">first_impl_ev</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">first_impl_ev</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="mi">0</span>
                    <span class="k">return</span> <span class="n">first_impl_ev</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">first_impl_ev</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">clause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">clause_id</span><span class="p">]</span>

        <span class="n">lvl0</span> <span class="o">=</span> <span class="n">priority_of_lit</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="p">)</span>
        <span class="n">lvl1</span> <span class="o">=</span> <span class="n">priority_of_lit</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">watch2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lvl1</span> <span class="o">&gt;</span> <span class="n">lvl0</span><span class="p">:</span>
            <span class="n">lvl0</span><span class="p">,</span> <span class="n">lvl1</span> <span class="o">=</span> <span class="n">lvl1</span><span class="p">,</span> <span class="n">lvl0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_swap_watch1_and_watch2</span><span class="p">(</span><span class="n">clause_id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">unwatched_indices</span><span class="p">)):</span>
            <span class="n">lvl</span> <span class="o">=</span> <span class="n">priority_of_lit</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">unwatched</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">lvl</span> <span class="o">&gt;</span> <span class="n">lvl1</span><span class="p">:</span>
                <span class="n">lvl1</span> <span class="o">=</span> <span class="n">lvl</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_swap_watch2_and_unwatched_i</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">lvl</span> <span class="o">&gt;</span> <span class="n">lvl0</span><span class="p">:</span>
                    <span class="n">lvl1</span> <span class="o">=</span> <span class="n">lvl0</span>
                    <span class="n">lvl0</span> <span class="o">=</span> <span class="n">lvl</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_swap_watch1_and_watch2</span><span class="p">(</span><span class="n">clause_id</span><span class="p">)</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_add_watch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">clause_id</span><span class="p">:</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a clause to the watch list of a literal.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">watchlists</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">literal</span><span class="p">)</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_remove_watch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">clause_id</span><span class="p">:</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes a clause from the watch list of a literal.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">watchlists</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">literal</span><span class="p">)</span>

    <span class="c1">#############################################################################</span>
    <span class="c1"># MAIN SOLVER DECISION LEVEL INCREASE &amp; DECREASE CALLBACKS</span>
    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">on_solver_increment_one_decision_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">next_unprocessed_solver_event_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses_trail</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">decision_level</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses_trail</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">on_solver_backtrack_one_decision_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">locked_clause</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">decision_level</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">locked_clause</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">decision_level</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">next_unprocessed_solver_event_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">num_events_at_current_decision_level</span>

    <span class="c1">#############################################################################</span>
    <span class="c1"># PROPAGATION</span>
    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">propagate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ReasonerBaseExplanation</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main propagation method of the SAT reasoner.</span>
<span class="sd">        Performs unit propagation (aka boolean constraint propagation).</span>

<span class="sd">        First, processes all pending clauses (i.e. clauses that were</span>
<span class="sd">        added to the database since last propagation but weren&#39;t processed</span>
<span class="sd">        yet), and sets their asserted literal to True (if they have one).</span>

<span class="sd">        If none of these clauses is found to be violated, any</span>
<span class="sd">        new (&quot;enqueued&quot;) &quot;unit information&quot; resulting from</span>
<span class="sd">        the processing of pending clauses is propagated.</span>

<span class="sd">        If at any point, either during pending clauses processing or propagation,</span>
<span class="sd">        a clause is found to be violated, the negation of its literals is</span>
<span class="sd">        returned as a base explanation to be refined by the main solver.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">violated_clause_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Process pending clauses</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_clauses_info</span><span class="p">:</span>

            <span class="n">clause_id</span><span class="p">,</span> <span class="n">asserted_literal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_clauses_info</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="n">violated_clause_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_pending_clause</span><span class="p">(</span><span class="n">clause_id</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">violated_clause_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="n">asserted_literal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">asserted_literal</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_from_unit_propagation</span><span class="p">(</span><span class="n">asserted_literal</span><span class="p">,</span> <span class="n">clause_id</span><span class="p">)</span>

        <span class="c1"># If no violated clause was detected above,</span>
        <span class="c1"># process/propagate new events/bound updates.</span>

        <span class="k">if</span> <span class="n">violated_clause_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_database</span><span class="p">()</span>

            <span class="n">violated_clause_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagate_enqueued</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">violated_clause_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># If at any point, a clause was found to be violated, return the negation</span>
        <span class="c1"># of its literals, to be used to build an explanation / asserting clause</span>

        <span class="n">violated_clause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">violated_clause_id</span><span class="p">]</span>
        <span class="n">base_explanation_lits</span> <span class="o">=</span> <span class="p">[</span><span class="n">lit</span><span class="o">.</span><span class="n">negated</span> <span class="k">for</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">violated_clause</span><span class="o">.</span><span class="n">literals</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">violated_clause</span><span class="o">.</span><span class="n">scope_literal</span> <span class="o">!=</span> <span class="n">TRUE_LIT</span><span class="p">:</span>
            <span class="n">base_explanation_lits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">violated_clause</span><span class="o">.</span><span class="n">scope_literal</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bump_activity</span><span class="p">(</span><span class="n">violated_clause_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ReasonerBaseExplanation</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">base_explanation_lits</span><span class="p">))</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_process_pending_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">clause_id</span><span class="p">:</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes a pending (i.e. newly added and not yet processed)</span>
<span class="sd">        clause, making no assumption on its status. The only requirement</span>
<span class="sd">        is that the clause should not have been processed yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">clause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">clause_id</span><span class="p">]</span>

        <span class="c1"># If the clause only has 1 literal, the processing is simplified</span>
        <span class="k">if</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch1</span> <span class="o">==</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch2</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>

            <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_literal_value</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="p">):</span>
                <span class="c1"># If the literal is known to be true, the clause is satisfied.</span>
                <span class="n">case</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span> 
                <span class="c1"># If the literal is known to be false, the clause is violated.</span>
                <span class="n">case</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_violated_clause</span><span class="p">(</span><span class="n">clause_id</span><span class="p">)</span>
                <span class="c1"># If the literal is unbound, it must be set to true</span>
                <span class="c1"># (because it&#39;s the only literal of the clause).</span>
                <span class="n">case</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_from_unit_propagation</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="p">,</span> <span class="n">clause_id</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># If the clause has 2 or more literals</span>

        <span class="c1"># Update watched literals (to possibly, but not necessarily new ones).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_move_watches_front</span><span class="p">(</span><span class="n">clause_id</span><span class="p">)</span>

        <span class="c1"># Determine whether a watch should indeed be set on the new 1st</span>
        <span class="c1"># and 2nd watched literals (based on the priority values - see `_move_watches_front()`)</span>

        <span class="n">watch1_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_literal_value</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="p">)</span>
        <span class="n">watch2_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_literal_value</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">watch2</span><span class="p">)</span>

        <span class="c1"># If the 1st watched literal is true, the clause is satisfied.</span>
        <span class="c1"># The state is unchanged and a watch is set. </span>
        <span class="k">if</span> <span class="n">watch1_value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch2</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># If the 1st watched literal is false, then the clause is</span>
        <span class="c1"># violated, as all the other literals can only be false as</span>
        <span class="c1"># well (because of watched literal selection priorities)</span>
        <span class="k">elif</span> <span class="n">watch1_value</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch2</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_violated_clause</span><span class="p">(</span><span class="n">clause_id</span><span class="p">)</span>

        <span class="c1"># If the 1st and 2nd watched literal are unbound,</span>
        <span class="c1"># the state is unchanged and a watch is set.</span>
        <span class="k">elif</span> <span class="n">watch2_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch2</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># If the 1st watched literal is unbound, and the 2nd one is not, the 2nd and all</span>
        <span class="c1"># unwatched literals are then necessarily false, because of the priority order,</span>
        <span class="c1"># which means the clause can only be unit (only 1st watched literal is unbound).</span>
        <span class="c1"># Set up the watch and (attempt to) set the 1st watched literal to true.</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch2</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_set_from_unit_propagation</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="p">,</span> <span class="n">clause_id</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_process_violated_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">clause_id</span><span class="p">:</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes a clause that is violated. This is done by deactivating</span>
<span class="sd">        the clause if possible (i.e. setting its scope literal to False)</span>
<span class="sd">        to avoid a conflict. If it&#39;s impossible, we are at conflict.</span>

<span class="sd">        Returns None if the clause was made deactivated (or if it already was deactivated),</span>
<span class="sd">        or clause_id if the clause is known to be active (i.e. cannot be deactivated).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">scope_literal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">clause_id</span><span class="p">]</span><span class="o">.</span><span class="n">scope_literal</span>

        <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_literal_value</span><span class="p">(</span><span class="n">scope_literal</span><span class="p">):</span>

            <span class="n">case</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">clause_id</span>

            <span class="n">case</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">case</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_from_unit_propagation</span><span class="p">(</span><span class="n">scope_literal</span><span class="o">.</span><span class="n">negated</span><span class="p">,</span> <span class="n">clause_id</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_propagate_enqueued</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Propagates enqueued &quot;unit information&quot;, notably new events resulting</span>
<span class="sd">        from the processing of pending clauses. As such, all clauses must be</span>
<span class="sd">        integrated to the database before this method is called (i.e. the queue</span>
<span class="sd">        of pending clauses must be empty).</span>

<span class="sd">        If a clause is found to be violated, returns its ID. Otherwise, returns None.</span>

<span class="sd">        This method can be seen as the equivalent of the &quot;enqueued&quot; facts</span>
<span class="sd">        to propagate in minisat / sat solvers).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Loop through yet unprocessed events, accumulated since the last call to this function.</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_unprocessed_solver_event_index</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">num_events_at_current_decision_level</span><span class="p">:</span>
            <span class="n">ev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">decision_level</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">next_unprocessed_solver_event_index</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_unprocessed_solver_event_index</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Select clauses with a literal that is </span>
            <span class="n">old_watchlists</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">BoundVal</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">watchlists</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span> <span class="p">{})</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">watchlists</span><span class="o">.</span><span class="n">has_elements_guarded_by_literals_on</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">signed_var</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">watchlists</span><span class="o">.</span><span class="n">remove_all_on</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">signed_var</span><span class="p">)</span>

            <span class="n">contradicting_clause_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">guard_bound_value</span><span class="p">,</span> <span class="n">clause_ids</span> <span class="ow">in</span> <span class="n">old_watchlists</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">watched_literal</span> <span class="o">=</span> <span class="n">Lit</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">guard_bound_value</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">clause_id</span> <span class="ow">in</span> <span class="n">clause_ids</span><span class="p">:</span>

                    <span class="c1"># If we haven&#39;t found a contradicting clause yet, and the event</span>
                    <span class="c1"># made the watched literal become true, we propagate the clause.</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">contradicting_clause_id</span> <span class="ow">is</span> <span class="kc">None</span>
                        <span class="ow">and</span> <span class="n">ev</span><span class="o">.</span><span class="n">new_bound_value</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">watched_literal</span><span class="o">.</span><span class="n">bound_value</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="ow">not</span> <span class="n">ev</span><span class="o">.</span><span class="n">previous_bound_value</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">watched_literal</span><span class="o">.</span><span class="n">bound_value</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagate_clause</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span>
                                                      <span class="n">Lit</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">ev</span><span class="o">.</span><span class="n">new_bound_value</span><span class="p">))</span>
                        <span class="p">):</span>
                            <span class="n">contradicting_clause_id</span> <span class="o">=</span> <span class="n">clause_id</span>

                    <span class="c1"># Otherwise, the watch must be restored.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">to_restore</span> <span class="o">=</span> <span class="n">Lit</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">guard_bound_value</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">to_restore</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">contradicting_clause_id</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_propagate_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
        <span class="n">clause_id</span><span class="p">:</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span>
        <span class="n">lit</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Propagates a clause that is watching a literal lit that became true.</span>
<span class="sd">        lit should be one of the literals watched by the clause.</span>
<span class="sd">        If the clause is:</span>
<span class="sd">         - pending: reset another watch and return true</span>
<span class="sd">         - unit: reset watch, enqueue the implied literal and return true</span>
<span class="sd">         - violated: reset watch and return false</span>

<span class="sd">        Counter intuitive: this method is only called after removing the watch</span>
<span class="sd">        and we are responsible for resetting a valid watch !</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">clause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">clause_id</span><span class="p">]</span>

        <span class="c1"># If the clause only has one literal and it&#39;s false, it is violated</span>
        <span class="k">if</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch1</span> <span class="o">==</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch2</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">lit</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_violated_clause</span><span class="p">(</span><span class="n">clause_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">lit</span><span class="o">.</span><span class="n">entails</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="o">.</span><span class="n">negated</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_swap_watch1_and_watch2</span><span class="p">(</span><span class="n">clause_id</span><span class="p">)</span>

        <span class="c1"># If the 1st watched literal is true, the clause is satisfied.</span>
        <span class="c1"># The watch is restored.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch2</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Search for a true or unbounded literal in the other literals</span>
        <span class="c1"># of the clause to set a watch on it.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">unwatched_indices</span><span class="p">)):</span>

            <span class="n">cached_unwatched</span> <span class="o">=</span> <span class="n">clause</span><span class="o">.</span><span class="n">unwatched</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">cached_unwatched</span><span class="o">.</span><span class="n">negated</span><span class="p">):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_swap_watch2_and_unwatched_i</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">cached_unwatched</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># If all searched for literals were false, then the clause is unit.</span>
        <span class="c1"># The watch must be restored and propagation performed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch2</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>

        <span class="n">cached_watch1</span> <span class="o">=</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">cached_watch1</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># If the clause is violated, deactivate it if possible</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">cached_watch1</span><span class="o">.</span><span class="n">negated</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_violated_clause</span><span class="p">(</span><span class="n">clause_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_from_unit_propagation</span><span class="p">(</span><span class="n">cached_watch1</span><span class="p">,</span> <span class="n">clause_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_set_from_unit_propagation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
        <span class="n">propagating_clause_id</span><span class="p">:</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the literal to true, as a result of unit propagation.</span>

<span class="sd">        We know that no inconsistency will occur (from the invariants of</span>
<span class="sd">        unit propagation). However, it might be the case that nothing</span>
<span class="sd">        happens if the literal is already known to be absent.</span>

<span class="sd">        Also locks the propagating clause, to prevent it</span>
<span class="sd">        from being removed from the database as a result of</span>
<span class="sd">        database scaling / learned clause forgetting.</span>

<span class="sd">        Indeed, this is necessary as the clause</span>
<span class="sd">        may be needed to provide an explanation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">is_bound_changed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set_literal</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span>
                                             <span class="n">Causes</span><span class="o">.</span><span class="n">ReasonerInference</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                                                                      <span class="n">propagating_clause_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">is_bound_changed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">decision_level</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">propagating_clause_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">propagating_clause_id</span><span class="p">)</span>
            <span class="c1"># FIXME:</span>
            <span class="c1"># if solver.clauses_db.clauses[propagating_clause_id].learned:</span>
            <span class="c1">#     lbd = self.lbd(literal, propagating_clause_id, solver)</span>
            <span class="c1">#     solver.clauses_db.set_lbd(propagating_clause_id, lbd)</span>

    <span class="c1">#############################################################################</span>
    <span class="c1"># EXPLANATION</span>
    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">explanation_literals</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Lit</span><span class="p">],</span>
        <span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
        <span class="n">inference_cause</span><span class="p">:</span> <span class="n">Causes</span><span class="o">.</span><span class="n">ReasonerInference</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">inference_info</span> <span class="o">=</span> <span class="n">inference_cause</span>

        <span class="n">clause_id</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span> <span class="n">inference_info</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bump_activity</span><span class="p">(</span><span class="n">clause_id</span><span class="p">)</span>
        <span class="n">clause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">clause_id</span><span class="p">]</span>

        <span class="c1"># In a normal SAT solver, we would expect the clause to be unit.</span>
        <span class="c1"># However, it is not necessarily the case with eager propagation of optionals.</span>
        <span class="k">for</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">clause</span><span class="o">.</span><span class="n">literals</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">lit</span><span class="o">.</span><span class="n">entails</span><span class="p">(</span><span class="n">literal</span><span class="p">):</span>
                <span class="n">explanation_literals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>

    <span class="c1">#############################################################################</span>
    <span class="c1"># CLAUSE DATABASE SCALING, ACTIVITIES</span>
    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">_scale_database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scales the size of the clauses database.</span>

<span class="sd">        The clauses database has a limited number of slots for learned clauses.</span>
<span class="sd">        When all slots are occupied, this function can:</span>

<span class="sd">        - Expand the database with more slots. This occurs if a certain number</span>
<span class="sd">        of conflicts (i.e. learned clauses) occured since last expansion.</span>

<span class="sd">        - Remove learned clauses from the database. This typically removes about</span>
<span class="sd">        half of the learned clauses, making sure that clauses that are used to</span>
<span class="sd">        explain the current value of the literal are kept (&quot;locked&quot; clauses).</span>
<span class="sd">        The clauses to be removed are those whose &quot;activity&quot; is the lowest.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_allowed_learned_clauses_before_forgetting</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">num_allowed_learned_clauses_before_forgetting</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">num_allowed_learned_clauses_before_forgetting_first_time</span> \
                <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_fixed_clauses</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_learned_clauses_ratio</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_learned_clauses</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses</span><span class="p">)</span>
            <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_allowed_learned_clauses_before_forgetting</span>
        <span class="p">):</span>  
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts_at_last_database_expansion</span>
                <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts_allowed_before_database_expansion</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num_allowed_learned_clauses_before_forgetting</span> <span class="o">=</span> \
                    <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_allowed_learned_clauses_before_forgetting</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_expansion_ratio</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts_at_last_database_expansion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts_allowed_before_database_expansion</span> <span class="o">=</span> \
                    <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts_allowed_before_database_expansion</span> 
                        <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">increase_ratio_of_conflicts_before_db_expansion</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">clauses_to_remove_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">clause_id</span> <span class="k">for</span> <span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                         <span class="k">if</span> <span class="n">clause</span><span class="o">.</span><span class="n">learned</span> <span class="ow">and</span> <span class="n">clause_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses</span><span class="p">]</span>

                <span class="n">clauses_to_remove_ids</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">activity</span><span class="p">)</span>
                <span class="n">clauses_to_remove_ids</span> <span class="o">=</span> <span class="n">clauses_to_remove_ids</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clauses_to_remove_ids</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>

                <span class="k">for</span> <span class="n">clause_id</span> <span class="ow">in</span> <span class="n">clauses_to_remove_ids</span><span class="p">:</span>
                    <span class="n">clause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">clause_id</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch1</span> <span class="o">==</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch2</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch1</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_watch</span><span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">clause</span><span class="o">.</span><span class="n">watch2</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">clause_id</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">num_learned_clauses</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_bump_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">clause_id</span><span class="p">:</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">clause_id</span><span class="p">]</span><span class="o">.</span><span class="n">activity</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clause_activity_increase</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">clause_id</span><span class="p">]</span><span class="o">.</span><span class="n">activity</span> <span class="o">&gt;</span> <span class="mf">1e100</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">clause</span><span class="o">.</span><span class="n">activity</span> <span class="o">*=</span> <span class="mf">1e-100</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">clause_activity_increase</span> <span class="o">*=</span> <span class="mf">1e-100</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_decay_activities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clause_activity_increase</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clause_activity_decay</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">





<h5 id="src.solver.reasoners.sat_reasoner.SATReasoner-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.clauses_database" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">clauses_database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">Clause</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  
      <p>The clauses database.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.clause_activity_increase" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">clause_activity_increase</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">clause_activity_increase</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.clause_activity_decay" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">clause_activity_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">clause_activity_decay</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.num_fixed_clauses" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">num_fixed_clauses</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.num_learned_clauses" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">num_learned_clauses</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.num_allowed_learned_clauses_before_forgetting" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">num_allowed_learned_clauses_before_forgetting</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.num_allowed_learned_clauses_before_forgetting_first_time" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">num_allowed_learned_clauses_before_forgetting_first_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_allowed_learned_clauses_before_forgetting_first_time</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.allowed_learned_clauses_ratio" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">allowed_learned_clauses_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">num_allowed_learned_clauses_ratio</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.num_conflicts" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">num_conflicts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.num_conflicts_at_last_database_expansion" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">num_conflicts_at_last_database_expansion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.num_conflicts_allowed_before_database_expansion" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">num_conflicts_allowed_before_database_expansion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_conflicts_allowed_before_database_expansion</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.database_expansion_ratio" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">database_expansion_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">database_expansion_ratio</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.increase_ratio_of_conflicts_before_db_expansion" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">increase_ratio_of_conflicts_before_db_expansion</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">increase_ratio_of_conflicts_before_db_expansion</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.locked_clauses" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">locked_clauses</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  
      <p>Contains all locked clauses (locked at all previous decision levels).
A clause that is marked as locked cannot be removed from the clause
database as part of database rescaling / forgetting of learned clauses.</p>
<p>Marking a clause as locked is necessary when that clause may be needed
for explanation mechanisms.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.locked_clauses_trail" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">locked_clauses_trail</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[]]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  
      <p>Trail of locked clauses. Outer list index: decision level.
Inner list content: clauses locked while at that decision level.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.watchlists" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">watchlists</span><span class="p">:</span> <span class="n">SetGuardedByLiterals</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]</span> <span class="o">=</span> <span class="n">SetGuardedByLiterals</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  
      <p>Represents literals' "watch lists" (lists of clauses where they appear).</p>
<p>Internally, a literal [signed_var &lt;= val]'s watchlist is represented as:
{ signed_var : { val : [clause1_id, clause2_id, ...] }}</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.pending_clauses_info" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pending_clauses_info</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Lit</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  
      <p>Stores clauses that have been recorded to the database,
but not processed yet.</p>
<p>The first element of the tuple is the ID of the clause to propagate.</p>
<p>The second element is either None or a literal that is entailed by
the clause at the current decision level. This literal MUST be set
to true, with this clause as its cause, even if the clause is not
unit.</p>
<p>This situation might happen when the clause was learned from
a conflict involving eager propagation of optional variables.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.next_unprocessed_solver_event_index" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">next_unprocessed_solver_event_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  
      <p>The index of the next unprocessed (i.e. not yet propagated) event
in the main solver's events trail (in the current decision level).</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.state" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">state</span><span class="p">:</span> <span class="n">SolverState</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>
<h5 id="src.solver.reasoners.sat_reasoner.SATReasoner-classes">Classes</h5>

<div class="doc doc-object doc-class">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause" class="doc doc-heading">
          <code>Clause</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">

  
      <p>Keeps the data of a clause registered in the clause database.</p>

            <details class="quote">
              <summary>Source code in <code>src/solver/reasoners/sat_reasoner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Clause</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Keeps the data of a clause registered in the clause database.&quot;&quot;&quot;</span>
    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="n">literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The literals of the clause (without the scope literal).&quot;&quot;&quot;</span>

    <span class="n">scope_literal</span><span class="p">:</span> <span class="n">Lit</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The literal representing the scope in which the clause</span>
<span class="sd">    (or rather its literals&#39; variables) are defined.</span>

<span class="sd">    As such, the true &quot;meaning&quot; of the clause can be expressed with the</span>
<span class="sd">    following disjunction: `(not scope_literal) | l_1 | ... | l_n`.</span>

<span class="sd">    This also means that a clause whose literals are all false is only a</span>
<span class="sd">    conflict when we cannot &quot;get out of&quot; its scope (i.e. make</span>
<span class="sd">    its `scope_literal` False).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="n">learned</span><span class="p">:</span> <span class="nb">bool</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether the clause is learned (i.e. resulting from conflict analysis) or not.&quot;&quot;&quot;</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="n">watch1_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Index of the first watched literal of the clause.&quot;&quot;&quot;</span>

    <span class="n">watch2_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Index of the second watched literal of the clause.&quot;&quot;&quot;</span>

    <span class="n">unwatched_indices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of the indices of unwatched literals of the clause.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">watch1</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lit</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">literals</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">watch1_index</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">watch2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lit</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">literals</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">watch2_index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">unwatched</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lit</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">literals</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unwatched_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="n">activity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># lbd: float = field(init=False)</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="c1"># &quot;&quot;&quot;</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span>
        <span class="n">scope_literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
        <span class="n">learned</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">literals</span> <span class="o">=</span> <span class="n">literals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope_literal</span> <span class="o">=</span> <span class="n">scope_literal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learned</span> <span class="o">=</span> <span class="n">learned</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">activity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># self.lbd = 0</span>

        <span class="n">len_literals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">literals</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">len_literals</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;Empty clauses are not allowed in the &quot;</span><span class="p">,</span>
                              <span class="s2">&quot;SAT reasoner / clause database&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">watch1_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">watch2_index</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">len_literals</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unwatched_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">len_literals</span><span class="p">))</span> <span class="k">if</span> <span class="n">len_literals</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">





<h7 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause-attributes">Attributes</h7>

<div class="doc doc-object doc-attribute">




<h8 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause.watch1" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">watch1</span><span class="p">:</span> <span class="n">Lit</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h8>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h8 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause.watch2" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">watch2</span><span class="p">:</span> <span class="n">Lit</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h8>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h8 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause.literals" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">literals</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h8>


  <div class="doc doc-contents ">
  
      <p>The literals of the clause (without the scope literal).</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h8 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause.scope_literal" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">scope_literal</span><span class="p">:</span> <span class="n">Lit</span> <span class="o">=</span> <span class="n">scope_literal</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h8>


  <div class="doc doc-contents ">
  
      <p>The literal representing the scope in which the clause
(or rather its literals' variables) are defined.</p>
<p>As such, the true "meaning" of the clause can be expressed with the
following disjunction: <code>(not scope_literal) | l_1 | ... | l_n</code>.</p>
<p>This also means that a clause whose literals are all false is only a
conflict when we cannot "get out of" its scope (i.e. make
its <code>scope_literal</code> False).</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h8 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause.learned" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">learned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">learned</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h8>


  <div class="doc doc-contents ">
  
      <p>Whether the clause is learned (i.e. resulting from conflict analysis) or not.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h8 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause.activity" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">activity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h8>


  <div class="doc doc-contents ">
  
      <p>TODO</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h8 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause.watch1_index" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">watch1_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h8>


  <div class="doc doc-contents ">
  
      <p>Index of the first watched literal of the clause.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h8 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause.watch2_index" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">watch2_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">len_literals</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h8>


  <div class="doc doc-contents ">
  
      <p>Index of the second watched literal of the clause.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h8 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause.unwatched_indices" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">unwatched_indices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">len_literals</span><span class="p">))</span> <span class="k">if</span> <span class="n">len_literals</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">[]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h8>


  <div class="doc doc-contents ">
  
      <p>List of the indices of unwatched literals of the clause.</p>
  </div>

</div>

<h7 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause-functions">Functions</h7>


<div class="doc doc-object doc-function">




<h8 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause.unwatched" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">unwatched</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lit</span></code>

</h8>


  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>src/solver/reasoners/sat_reasoner.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unwatched</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lit</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">literals</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unwatched_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h8 id="src.solver.reasoners.sat_reasoner.SATReasoner.Clause.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">scope_literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span> <span class="n">learned</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span></code>

</h8>


  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>src/solver/reasoners/sat_reasoner.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span>
    <span class="n">scope_literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="n">learned</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">literals</span> <span class="o">=</span> <span class="n">literals</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scope_literal</span> <span class="o">=</span> <span class="n">scope_literal</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">learned</span> <span class="o">=</span> <span class="n">learned</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">activity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># self.lbd = 0</span>

    <span class="n">len_literals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">literals</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">len_literals</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;Empty clauses are not allowed in the &quot;</span><span class="p">,</span>
                          <span class="s2">&quot;SAT reasoner / clause database&quot;</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">watch1_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">watch2_index</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">len_literals</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unwatched_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">len_literals</span><span class="p">))</span> <span class="k">if</span> <span class="n">len_literals</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.ClauseId" class="doc doc-heading">
          <code>ClauseId</code>


</h6>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>int</code></p>

  
      <p>Represents the ID of a clause in the database.</p>

            <details class="quote">
              <summary>Source code in <code>src/solver/reasoners/sat_reasoner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ClauseId</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents the ID of a clause in the database.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>

  </div>

</div>
<h5 id="src.solver.reasoners.sat_reasoner.SATReasoner-functions">Functions</h5>


<div class="doc doc-object doc-function">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">SolverState</span><span class="p">,</span> <span class="n">clause_activity_increase</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">clause_activity_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.999</span><span class="p">,</span> <span class="n">num_allowed_learned_clauses_before_forgetting_first_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">num_allowed_learned_clauses_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">num_conflicts_allowed_before_database_expansion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">database_expansion_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.05</span><span class="p">,</span> <span class="n">increase_ratio_of_conflicts_before_db_expansion</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">)</span></code>

</h6>


  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>src/solver/reasoners/sat_reasoner.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">SolverState</span><span class="p">,</span>
    <span class="n">clause_activity_increase</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">clause_activity_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.999</span><span class="p">,</span>
    <span class="n">num_allowed_learned_clauses_before_forgetting_first_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">num_allowed_learned_clauses_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">num_conflicts_allowed_before_database_expansion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">database_expansion_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.05</span><span class="p">,</span>
    <span class="n">increase_ratio_of_conflicts_before_db_expansion</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
<span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">:</span> <span class="n">SolverState</span> <span class="o">=</span> <span class="n">state</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_clauses_id_counter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span> <span class="n">SATReasoner</span><span class="o">.</span><span class="n">Clause</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The clauses database.&quot;&quot;&quot;</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">clause_activity_increase</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">clause_activity_increase</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">clause_activity_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">clause_activity_decay</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">num_fixed_clauses</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">num_learned_clauses</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># The difference between the number of conflicts</span>
                                        <span class="c1"># and the number of learned clauses is that the</span>
                                        <span class="c1"># number of conflicts never gets smaller, but the</span>
                                        <span class="c1"># number of learned clauses can (when reducing</span>
                                        <span class="c1"># the database / forgetting learned clauses). </span>

    <span class="bp">self</span><span class="o">.</span><span class="n">num_allowed_learned_clauses_before_forgetting</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Not initialized yet. &quot;Actual&quot; initial value</span>
                                                                <span class="c1"># assigned at the first call to `scale_database`,</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">num_allowed_learned_clauses_before_forgetting_first_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_allowed_learned_clauses_before_forgetting_first_time</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">allowed_learned_clauses_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">num_allowed_learned_clauses_ratio</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts_at_last_database_expansion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts_allowed_before_database_expansion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_conflicts_allowed_before_database_expansion</span>
                                                                <span class="c1"># TODO synchronize with restarts !!!</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">database_expansion_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">database_expansion_ratio</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">increase_ratio_of_conflicts_before_db_expansion</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">increase_ratio_of_conflicts_before_db_expansion</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Contains all locked clauses (locked at all previous decision levels).</span>
<span class="sd">    A clause that is marked as locked cannot be removed from the clause</span>
<span class="sd">    database as part of database rescaling / forgetting of learned clauses.</span>

<span class="sd">    Marking a clause as locked is necessary when that clause may be needed</span>
<span class="sd">    for explanation mechanisms.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses_trail</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[]]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trail of locked clauses. Outer list index: decision level.</span>
<span class="sd">    Inner list content: clauses locked while at that decision level.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">watchlists</span><span class="p">:</span> <span class="n">SetGuardedByLiterals</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]</span> <span class="o">=</span> <span class="n">SetGuardedByLiterals</span><span class="p">()</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents literals&#39; &quot;watch lists&quot; (lists of clauses where they appear).</span>

<span class="sd">    Internally, a literal [signed_var &lt;= val]&#39;s watchlist is represented as:</span>
<span class="sd">    { signed_var : { val : [clause1_id, clause2_id, ...] }}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pending_clauses_info</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Lit</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stores clauses that have been recorded to the database,</span>
<span class="sd">    but not processed yet.</span>

<span class="sd">    The first element of the tuple is the ID of the clause to propagate.</span>

<span class="sd">    The second element is either None or a literal that is entailed by</span>
<span class="sd">    the clause at the current decision level. This literal MUST be set</span>
<span class="sd">    to true, with this clause as its cause, even if the clause is not</span>
<span class="sd">    unit.</span>

<span class="sd">    This situation might happen when the clause was learned from</span>
<span class="sd">    a conflict involving eager propagation of optional variables.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">next_unprocessed_solver_event_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The index of the next unprocessed (i.e. not yet propagated) event</span>
<span class="sd">    in the main solver&#39;s events trail (in the current decision level).</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.add_new_fixed_clause_with_scope" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_new_fixed_clause_with_scope</span><span class="p">(</span><span class="n">clause_literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">scope_literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Adds a new non-learned clause to the clauses database
and to the pending clauses queue.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>clause_literals</b>
            (<code><span title="typing.Tuple">Tuple</span>[<a class="autorefs autorefs-internal" title="src.fundamentals.Lit" href="../fundamentals/#src.fundamentals.Lit">Lit</a>, ...]</code>)
        –
        <div class="doc-md-description">
          <p>The literals composing the clause.</p>
        </div>
      </li>
      <li class="field-body">
        <b>scope_literal</b>
            (<code><a class="autorefs autorefs-internal" title="src.fundamentals.Lit" href="../fundamentals/#src.fundamentals.Lit">Lit</a></code>)
        –
        <div class="doc-md-description">
          <p>The literal representing the scope in which                  the clause is defined.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>None</code>
        –
        <div class="doc-md-description">
          <p>The ID given to the clause after being registered in the clauses database.</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>src/solver/reasoners/sat_reasoner.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_new_fixed_clause_with_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">clause_literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span>
    <span class="n">scope_literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a new non-learned clause to the clauses database</span>
<span class="sd">    and to the pending clauses queue.</span>

<span class="sd">    Args:</span>
<span class="sd">        clause_literals: The literals composing the clause.</span>

<span class="sd">        scope_literal: The literal representing the scope in which  \</span>
<span class="sd">            the clause is defined.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The ID given to the clause after being registered in the clauses database.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">clause_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_new_clause</span><span class="p">(</span><span class="n">clause_literals</span><span class="p">,</span> <span class="n">scope_literal</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pending_clauses_info</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_fixed_clauses</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.add_new_learned_clause" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_new_learned_clause</span><span class="p">(</span><span class="n">asserting_clause_literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">asserted_literal</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Lit</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Adds a new learned clause to the clauses database
and to the pending clauses queue.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>clause_literals</b>
        –
        <div class="doc-md-description">
          <p>The literals composing the clause.</p>
        </div>
      </li>
      <li class="field-body">
        <b>scope_literal</b>
        –
        <div class="doc-md-description">
          <p>The literal representing the scope in which                  the clause is defined.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>None</code>
        –
        <div class="doc-md-description">
          <p>The ID given to the clause after being registered in the clauses database.</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>src/solver/reasoners/sat_reasoner.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_new_learned_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">asserting_clause_literals</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span>
    <span class="n">asserted_literal</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Lit</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a new learned clause to the clauses database</span>
<span class="sd">    and to the pending clauses queue.</span>

<span class="sd">    Args:</span>
<span class="sd">        clause_literals: The literals composing the clause.</span>

<span class="sd">        scope_literal: The literal representing the scope in which  \</span>
<span class="sd">            the clause is defined.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The ID given to the clause after being registered in the clauses database.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">asserted_literal</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">asserted_literal</span> <span class="ow">in</span> <span class="n">asserting_clause_literals</span>

    <span class="n">clause_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_new_clause</span><span class="p">(</span><span class="n">asserting_clause_literals</span><span class="p">,</span> <span class="n">TRUE_LIT</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pending_clauses_info</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">clause_id</span><span class="p">,</span> <span class="n">asserted_literal</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_learned_clauses</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_conflicts</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.on_solver_increment_one_decision_level" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">on_solver_increment_one_decision_level</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h6>


  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>src/solver/reasoners/sat_reasoner.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">on_solver_increment_one_decision_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">next_unprocessed_solver_event_index</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses_trail</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">decision_level</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses_trail</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.on_solver_backtrack_one_decision_level" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">on_solver_backtrack_one_decision_level</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h6>


  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>src/solver/reasoners/sat_reasoner.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">on_solver_backtrack_one_decision_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

    <span class="k">for</span> <span class="n">locked_clause</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">decision_level</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">locked_clause</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">locked_clauses_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">decision_level</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">next_unprocessed_solver_event_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">num_events_at_current_decision_level</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.propagate" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">propagate</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ReasonerBaseExplanation</span><span class="p">]</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Main propagation method of the SAT reasoner.
Performs unit propagation (aka boolean constraint propagation).</p>
<p>First, processes all pending clauses (i.e. clauses that were
added to the database since last propagation but weren't processed
yet), and sets their asserted literal to True (if they have one).</p>
<p>If none of these clauses is found to be violated, any
new ("enqueued") "unit information" resulting from
the processing of pending clauses is propagated.</p>
<p>If at any point, either during pending clauses processing or propagation,
a clause is found to be violated, the negation of its literals is
returned as a base explanation to be refined by the main solver.</p>

          <details class="quote">
            <summary>Source code in <code>src/solver/reasoners/sat_reasoner.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">propagate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ReasonerBaseExplanation</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main propagation method of the SAT reasoner.</span>
<span class="sd">    Performs unit propagation (aka boolean constraint propagation).</span>

<span class="sd">    First, processes all pending clauses (i.e. clauses that were</span>
<span class="sd">    added to the database since last propagation but weren&#39;t processed</span>
<span class="sd">    yet), and sets their asserted literal to True (if they have one).</span>

<span class="sd">    If none of these clauses is found to be violated, any</span>
<span class="sd">    new (&quot;enqueued&quot;) &quot;unit information&quot; resulting from</span>
<span class="sd">    the processing of pending clauses is propagated.</span>

<span class="sd">    If at any point, either during pending clauses processing or propagation,</span>
<span class="sd">    a clause is found to be violated, the negation of its literals is</span>
<span class="sd">    returned as a base explanation to be refined by the main solver.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">violated_clause_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Process pending clauses</span>

    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_clauses_info</span><span class="p">:</span>

        <span class="n">clause_id</span><span class="p">,</span> <span class="n">asserted_literal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_clauses_info</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="n">violated_clause_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_pending_clause</span><span class="p">(</span><span class="n">clause_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">violated_clause_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="k">if</span> <span class="n">asserted_literal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">asserted_literal</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_from_unit_propagation</span><span class="p">(</span><span class="n">asserted_literal</span><span class="p">,</span> <span class="n">clause_id</span><span class="p">)</span>

    <span class="c1"># If no violated clause was detected above,</span>
    <span class="c1"># process/propagate new events/bound updates.</span>

    <span class="k">if</span> <span class="n">violated_clause_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_database</span><span class="p">()</span>

        <span class="n">violated_clause_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagate_enqueued</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">violated_clause_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># If at any point, a clause was found to be violated, return the negation</span>
    <span class="c1"># of its literals, to be used to build an explanation / asserting clause</span>

    <span class="n">violated_clause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">violated_clause_id</span><span class="p">]</span>
    <span class="n">base_explanation_lits</span> <span class="o">=</span> <span class="p">[</span><span class="n">lit</span><span class="o">.</span><span class="n">negated</span> <span class="k">for</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">violated_clause</span><span class="o">.</span><span class="n">literals</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">violated_clause</span><span class="o">.</span><span class="n">scope_literal</span> <span class="o">!=</span> <span class="n">TRUE_LIT</span><span class="p">:</span>
        <span class="n">base_explanation_lits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">violated_clause</span><span class="o">.</span><span class="n">scope_literal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bump_activity</span><span class="p">(</span><span class="n">violated_clause_id</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ReasonerBaseExplanation</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">base_explanation_lits</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.reasoners.sat_reasoner.SATReasoner.explain" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">explain</span><span class="p">(</span><span class="n">explanation_literals</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Lit</span><span class="p">],</span> <span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span> <span class="n">inference_cause</span><span class="p">:</span> <span class="n">Causes</span><span class="o">.</span><span class="n">ReasonerInference</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>TODO</p>

          <details class="quote">
            <summary>Source code in <code>src/solver/reasoners/sat_reasoner.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">explanation_literals</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Lit</span><span class="p">],</span>
    <span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="n">inference_cause</span><span class="p">:</span> <span class="n">Causes</span><span class="o">.</span><span class="n">ReasonerInference</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">inference_info</span> <span class="o">=</span> <span class="n">inference_cause</span>

    <span class="n">clause_id</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">SATReasoner</span><span class="o">.</span><span class="n">ClauseId</span><span class="p">,</span> <span class="n">inference_info</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_bump_activity</span><span class="p">(</span><span class="n">clause_id</span><span class="p">)</span>
    <span class="n">clause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clauses_database</span><span class="p">[</span><span class="n">clause_id</span><span class="p">]</span>

    <span class="c1"># In a normal SAT solver, we would expect the clause to be unit.</span>
    <span class="c1"># However, it is not necessarily the case with eager propagation of optionals.</span>
    <span class="k">for</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">clause</span><span class="o">.</span><span class="n">literals</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lit</span><span class="o">.</span><span class="n">entails</span><span class="p">(</span><span class="n">literal</span><span class="p">):</span>
            <span class="n">explanation_literals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  </body>
</html>