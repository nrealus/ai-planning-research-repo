
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../common/">
      
      
        <link rel="next" href="../solver/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.8">
    
    
      
        <title>Solver State - AI Planning Research Project</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.046329b4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra_style.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.solver.solver_state-attributes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="AI Planning Research Project" class="md-header__button md-logo" aria-label="AI Planning Research Project" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AI Planning Research Project
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Solver State
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AI Planning Research Project" class="md-nav__button md-logo" aria-label="AI Planning Research Project" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    AI Planning Research Project
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aries-like Solver Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../cdcl_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example CDCL search
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../fundamentals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fundamentals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../constraint_expressions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Constraint Expressions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Solver
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Solver
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../common/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Common
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Solver State
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Solver State
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.solver.solver_state-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.solver.solver_state-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState" class="md-nav__link">
    SolverState
  </a>
  
    <nav class="md-nav" aria-label="SolverState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.decision_level" class="md-nav__link">
    decision_level
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.num_events_at_current_decision_level" class="md-nav__link">
    num_events_at_current_decision_level
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.bound_value_of" class="md-nav__link">
    bound_value_of()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.presence_literal_of" class="md-nav__link">
    presence_literal_of()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.is_entailed" class="md-nav__link">
    is_entailed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.is_implication_true" class="md-nav__link">
    is_implication_true()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.first_event_entailing" class="md-nav__link">
    first_event_entailing()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.is_assignment_complete" class="md-nav__link">
    is_assignment_complete()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.set_literal" class="md-nav__link">
    set_literal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.set_bound_value" class="md-nav__link">
    set_bound_value()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../solver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solver Main Class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_4" >
        
          <label class="md-nav__link" for="__nav_3_3_4" id="__nav_3_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reasoners
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_4">
            <span class="md-nav__icon md-icon"></span>
            Reasoners
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../reasoner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reasoner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sat_reasoner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SAT Reasoner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../diff_reasoner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Difference Logic Reasoner
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_5" >
        
          <label class="md-nav__link" for="__nav_3_3_5" id="__nav_3_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Branchers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_5">
            <span class="md-nav__icon md-icon"></span>
            Branchers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../brancher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Brancher
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.solver.solver_state-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.solver.solver_state-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState" class="md-nav__link">
    SolverState
  </a>
  
    <nav class="md-nav" aria-label="SolverState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.decision_level" class="md-nav__link">
    decision_level
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.num_events_at_current_decision_level" class="md-nav__link">
    num_events_at_current_decision_level
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.bound_value_of" class="md-nav__link">
    bound_value_of()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.presence_literal_of" class="md-nav__link">
    presence_literal_of()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.is_entailed" class="md-nav__link">
    is_entailed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.is_implication_true" class="md-nav__link">
    is_implication_true()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.first_event_entailing" class="md-nav__link">
    first_event_entailing()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.is_assignment_complete" class="md-nav__link">
    is_assignment_complete()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.set_literal" class="md-nav__link">
    set_literal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.solver.solver_state.SolverState.set_bound_value" class="md-nav__link">
    set_bound_value()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Solver State</h1>

<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">
  
      <p>This module defines the main low-level class of the solver.</p>
<p>It contains low-level methods allowing to query the state of the solver,
as well as arguably the most important method of the whole solver:
<code>set_bound_literal</code> (and its syntactic sugar <code>set_literal</code>).</p>

  

  <div class="doc doc-children">





<h3 id="src.solver.solver_state-attributes">Attributes</h3>
<h3 id="src.solver.solver_state-classes">Classes</h3>

<div class="doc doc-object doc-class">




<h4 id="src.solver.solver_state.SolverState" class="doc doc-heading">
          <code>SolverState</code>


</h4>


  <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>src/solver/solver_state.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span>
<span class="normal">995</span>
<span class="normal">996</span>
<span class="normal">997</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SolverState</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vars_id_counter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">Var</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span> <span class="kc">False</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="p">}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores all the variables known to the solver.</span>

<span class="sd">        The controllable variables are in the set under key True,</span>
<span class="sd">        and the uncontrollable ones are in the set under key False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_presence_literals</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Var</span><span class="p">,</span> <span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maps variables to their presence literals.</span>

<span class="sd">        Variables of presence literals have to be non-optional</span>
<span class="sd">        (i.e. have the TRUE_LIT as their presence literal).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_non_optionals_implication_graph</span><span class="p">:</span> <span class="n">SetGuardedByLiterals</span><span class="p">[</span><span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="n">SetGuardedByLiterals</span><span class="p">()</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Represents an implication graph on literals of non-optional variables</span>
<span class="sd">        (most notably presence literals).</span>

<span class="sd">        An implication [svar1 &lt;= a] =&gt; [svar2 &lt;= b] is encoded as:</span>
<span class="sd">        { svar1 : { a : [svar2 &lt;= b] } }. As such, if we want to check if</span>
<span class="sd">        [svar1 &lt;= c] implies [svar2 &lt;= d], we iterate through guard values</span>
<span class="sd">        weaker (&gt;=) than c, and search for any literal entailing [svar2 &lt;= d]</span>
<span class="sd">        (i.e. on the same signed variable (svar2) and with weaker (&gt;=) bound than d).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">SignedVar</span><span class="p">,</span> <span class="n">BoundVal</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The main &quot;domains&quot; structure.</span>
<span class="sd">        Stores the upper and lower bounds of variables&#39; domains (at the current decision level).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dec_lvl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The current decision level of the solver.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Event</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[]]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The trail of events.</span>

<span class="sd">        Uses double indices: the index in outer list is the decision level of the event.</span>
<span class="sd">        The index in the inner list is the index of the event in that decision level.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values_event_indices</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">SignedVar</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the indices in `events_trail` of events that set the (current) bounds of variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_lits_of_lit_conjs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores conjunctions of (presence) literals corresponding to (conjunctive)</span>
<span class="sd">        scopes that have been defined in the problem, as well as the associated</span>
<span class="sd">        &quot;scope literals&quot; representing them.</span>

<span class="sd">        A conjunctive scope is created when we want to refer to a subset of the</span>
<span class="sd">        problem that exists iff all required scopes are present. For example, the </span>
<span class="sd">        expression &quot;a &lt;= b&quot; is defined iff both a and b are present. It can be said</span>
<span class="sd">        to exist in the conjunctive scope &quot;presence(a) &amp; presence(b)&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_representative_lit_conjs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The reverse of `scopes`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_tautologies</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span> <span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For each scope literal, associates a literal (on an optional variable).</span>
<span class="sd">        When we&#39;re in that scope (i.e. the scope literal is true, i.e. all the</span>
<span class="sd">        literals defining it are true) that literal is always true. When we&#39;re</span>
<span class="sd">        not in that scope, the variable of this literal is absent. As such, this</span>
<span class="sd">        literal can indeed be called &quot;tautology of the scope&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">ElemConstrExpr</span><span class="p">,</span> <span class="n">Lit</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores pairs consisting of a constraint (in elementary form) and a literal,</span>
<span class="sd">        stating that the literal must be true iff the constraint is true.</span>

<span class="sd">        REVIEW? Both &quot;real&quot; reified constraints that were defined in the problem</span>
<span class="sd">        and &quot;artificial&quot;/&quot;intermediary&quot; constraints can be found here.</span>
<span class="sd">        Apart from pairs consisting of a (reified) constraint and its reification</span>
<span class="sd">        literal, there can be pairs where the constraint is simply the satisfaction</span>
<span class="sd">        of a reification literal of another constraint. This allows to enforce</span>
<span class="sd">        a sort of &quot;chain of constraints&quot;. REVIEW?</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_reifications</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ElemConstrExpr</span><span class="p">,</span> <span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores reification literals of constraints that were defined in the problem (in</span>
<span class="sd">        their &quot;elementary&quot; form) and reified.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vars</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ZERO_VAR</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_presence_literals</span><span class="p">[</span><span class="n">ZERO_VAR</span><span class="p">]</span> <span class="o">=</span> <span class="n">TRUE_LIT</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">[</span><span class="n">SignedVar</span><span class="o">.</span><span class="n">plus</span><span class="p">(</span><span class="n">ZERO_VAR</span><span class="p">)]</span> <span class="o">=</span> <span class="n">BoundVal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">[</span><span class="n">SignedVar</span><span class="o">.</span><span class="n">minus</span><span class="p">(</span><span class="n">ZERO_VAR</span><span class="p">)]</span> <span class="o">=</span> <span class="n">BoundVal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_lits_of_lit_conjs</span><span class="p">[()]</span> <span class="o">=</span> <span class="n">TRUE_LIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_representative_lit_conjs</span><span class="p">[</span><span class="n">TRUE_LIT</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_tautologies</span><span class="p">[</span><span class="n">TRUE_LIT</span><span class="p">]</span> <span class="o">=</span> <span class="n">TRUE_LIT</span>

    <span class="c1">#############################################################################</span>
    <span class="c1"># PROPERTIES &amp; QUERIES / GETTERS</span>
    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">bound_value_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">signed_var</span><span class="p">:</span> <span class="n">SignedVar</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoundVal</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            signed_var: The signed variable whose bound to get.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The current bound of `signed_var`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">[</span><span class="n">signed_var</span><span class="p">]</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>
<span class="c1">#</span>
<span class="c1">#    def lower_bound_value_of(self,</span>
<span class="c1">#        var: Var</span>
<span class="c1">#    ) -&gt; BoundVal:</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        Args:</span>
<span class="c1">#            var: The variable whose lower bound to get.</span>
<span class="c1">#        </span>
<span class="c1">#        Returns:</span>
<span class="c1">#            The current lower bound of `var`.</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        return -self.bound_value_of(SignedVar.minus(var))</span>
<span class="c1">#</span>
<span class="c1">#    # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>
<span class="c1">#</span>
<span class="c1">#    def upper_bound_value_of(self,</span>
<span class="c1">#        var: Var</span>
<span class="c1">#    ) -&gt; BoundVal:</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        Args:</span>
<span class="c1">#            var: The variable whose upper bound to get.</span>
<span class="c1">#        </span>
<span class="c1">#        Returns:</span>
<span class="c1">#            The current upper bound of `var`.</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        return self.bound_value_of(SignedVar.plus(var))</span>
<span class="c1">#</span>
    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">presence_literal_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">var</span><span class="p">:</span> <span class="n">Var</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lit</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            var: The variable whose presence literal to get.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The presence literal of `var`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_presence_literals</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">is_entailed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            literal: The literal whose entailment to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether `literal` is entailed at the current decision   \</span>
<span class="sd">                level (i.e. its bound value is weaker than its      \</span>
<span class="sd">                signed variable&#39;s current bound).</span>
<span class="sd">        &quot;&quot;&quot;</span> 

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">literal</span><span class="o">.</span><span class="n">signed_var</span><span class="p">)</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">literal</span><span class="o">.</span><span class="n">bound_value</span><span class="p">)</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">is_implication_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">literal_from</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
        <span class="n">literal_to</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            literal_from: The &quot;source&quot; of the implication to check.</span>
<span class="sd">            literal_to: The &quot;target&quot; of the implication to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the implication `literal_from` =&gt; `literal_to` is true.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Obvious cases where the implication is known to be true.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">literal_to</span> <span class="o">==</span> <span class="n">TRUE_LIT</span>
            <span class="ow">or</span> <span class="n">literal_from</span> <span class="o">==</span> <span class="n">FALSE_LIT</span>
            <span class="ow">or</span> <span class="n">literal_from</span><span class="o">.</span><span class="n">entails</span><span class="p">(</span><span class="n">literal_to</span><span class="p">)</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">literal_from</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">literal_to</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span> 

        <span class="c1"># When there are no &quot;incoming edges&quot; to `literal_to` in the implication</span>
        <span class="c1"># graph (i.e. &quot;outgoing edges&quot; from `literal_to.negated`), there can&#39;t</span>
        <span class="c1"># be any implications to `literal_to`. Thus we return False.</span>
        <span class="c1"># NOTE: This check is possible because for each (x -&gt; y) &quot;edge&quot; to add</span>
        <span class="c1"># in the implication graph, we also explicitly add a (!y -&gt; !x) &quot;edge&quot;.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_optionals_implication_graph</span><span class="o">.</span><span class="n">has_elements_guarded_by</span><span class="p">(</span><span class="n">literal_to</span><span class="o">.</span><span class="n">negated</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Depth first search through the implication graph, starting</span>
        <span class="c1"># at `literal_from`. Look for a literal that entails `literal_to`</span>
        <span class="c1"># to determine whether `literal_from` implies `literal_to`.</span>

        <span class="n">stack</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">literal_from</span><span class="p">]</span>
        <span class="n">visited</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">SignedVar</span><span class="p">,</span> <span class="n">BoundVal</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
            <span class="n">lit</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="c1"># If the current literal entails `literal_to`, then we won:</span>
            <span class="c1"># `literal_to` is reachable from `literal_from`.</span>
            <span class="c1"># Thus `literal_from` does imply `literal_to` and we return True.</span>
            <span class="k">if</span> <span class="n">lit</span><span class="o">.</span><span class="n">entails</span><span class="p">(</span><span class="n">literal_to</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                <span class="n">visited</span><span class="p">[</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">lit</span><span class="o">.</span><span class="n">bound_value</span>

            <span class="c1"># If we have already visited a literal that entails the</span>
            <span class="c1"># current one, then there is no hope in pursuing the search</span>
            <span class="c1"># further in this path (because the search is depth-first).</span>
            <span class="k">elif</span> <span class="n">lit</span><span class="o">.</span><span class="n">bound_value</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">visited</span><span class="p">[</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">]):</span>
                <span class="k">continue</span>                                                    

            <span class="c1"># If the current literal doesn&#39;t imply anything, then it can&#39;t</span>
            <span class="c1"># imply possibly `literal_to`: no hope in pursuing the search</span>
            <span class="c1"># further in this path (because the search is depth-first).</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_optionals_implication_graph</span><span class="o">.</span><span class="n">has_elements_guarded_by</span><span class="p">(</span><span class="n">lit</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># Push literals &quot;directly implied&quot; by the current literal to the search stack.</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_optionals_implication_graph</span><span class="o">.</span><span class="n">elements_guarded_by</span><span class="p">(</span><span class="n">lit</span><span class="p">))</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">decision_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The current decision level of the solver.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dec_lvl</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_events_at_current_decision_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of events at the current decision level.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">decision_level</span><span class="p">])</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">first_event_entailing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Event</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            literal: The literal whose first entailing event to find.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The earliest first event that makes `literal` true.</span>
<span class="sd">            None if there are no events on `literal`&#39;s signed variable.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if `literal` isn&#39;t currently entailed.</span>

<span class="sd">        Note:</span>
<span class="sd">            The method works by walking in reverse order through events on</span>
<span class="sd">            the signed variable of `literal`. The first event that makes</span>
<span class="sd">            `literal` true is the one whose previous value was weaker</span>
<span class="sd">            than `literal`&#39;s bound value (i.e. the literal wasn&#39;t</span>
<span class="sd">            entailed before this event).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">literal</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;Literal not entailed: A literal must be entailed &quot;</span><span class="p">,</span>
                              <span class="s2">&quot;to find its first entailing event&quot;</span><span class="p">))</span>

        <span class="n">ev</span><span class="p">:</span> <span class="n">Event</span>

        <span class="n">ev_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values_event_indices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">literal</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">ev_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">dl</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ev_index</span>
            <span class="n">ev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">[</span><span class="n">dl</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">previous_bound_value</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">literal</span><span class="o">.</span><span class="n">bound_value</span><span class="p">):</span>
                <span class="n">ev_index</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">previous_index</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">ev</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">is_assignment_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">SignedVar</span><span class="o">.</span><span class="n">plus</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
                    <span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">SignedVar</span><span class="o">.</span><span class="n">minus</span><span class="p">(</span><span class="n">var</span><span class="p">)))</span>
                    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vars</span><span class="p">[</span><span class="kc">True</span><span class="p">]])</span>

    <span class="c1">#############################################################################</span>
    <span class="c1"># BOUND VALUE UPDATE</span>
    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">set_literal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
        <span class="n">cause</span><span class="p">:</span> <span class="n">Causes</span><span class="o">.</span><span class="n">AnyCause</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">InvalidBoundUpdateInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Syntactic sugar for `set_bound_value`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_bound_value</span><span class="p">(</span><span class="n">literal</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">literal</span><span class="o">.</span><span class="n">bound_value</span><span class="p">,</span> <span class="n">cause</span><span class="p">)</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">set_bound_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">signed_var</span><span class="p">:</span> <span class="n">SignedVar</span><span class="p">,</span>
        <span class="n">bound_value</span><span class="p">:</span> <span class="n">BoundVal</span><span class="p">,</span>
        <span class="n">cause</span><span class="p">:</span> <span class="n">Causes</span><span class="o">.</span><span class="n">AnyCause</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">InvalidBoundUpdateInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One of the most (arguably the most) important method of the solver.</span>

<span class="sd">        Attempts to set a new bound on a signed variable, which is equivalent</span>
<span class="sd">        to setting / entailing / enforcing the corresponding literal.</span>

<span class="sd">        When the bound update is useless (the variable is optional and absent,</span>
<span class="sd">        or the current bound is stronger than the given one), doesn&#39;t do</span>
<span class="sd">        anything and returns False.</span>

<span class="sd">        When the bound update leads to an empty domain for this given signed</span>
<span class="sd">        variable&#39;s variable, there are 2 possible cases:</span>

<span class="sd">        - If the variable is non-optional, immediately return a `InvalidBoundUpdateInfo`.</span>

<span class="sd">        - If the variable is optional, sets the new bound and attempts to set</span>
<span class="sd">        the negation of the variable&#39;s presence literal with a new call to</span>
<span class="sd">        `set_bound_value`. The results of this recursive call are then returned.</span>

<span class="sd">        If the variable is non-optional, the given new bound is not useless (i.e.</span>
<span class="sd">        strictly stronger than the current one), and it doesn&#39;t make the variable&#39;s</span>
<span class="sd">        domain empty, performs &quot;implication propagation&quot; of this update to literals</span>
<span class="sd">        on non-optional variables (in the `_non_optionals_implication_graph`) by</span>
<span class="sd">        recursively calling `set_bound_value`. If any of those calls leads to a</span>
<span class="sd">        failure / invalid bound update, the corresponding `InvalidBoundUpdateInfo`</span>
<span class="sd">        will be returned.</span>

<span class="sd">        Finally, when the bound was was successfully updated without leading to an</span>
<span class="sd">        empty domain for any variable, True is returned.</span>

<span class="sd">        Args:</span>
<span class="sd">            signed_var: The signed variable whose bound to set.</span>
<span class="sd">            bound_value: The bound value to set on `signed_var`.</span>
<span class="sd">            cause: The cause for this bound update.</span>

<span class="sd">        Returns:</span>
<span class="sd">            False if the update was useless, True if the update was performed   \</span>
<span class="sd">                successfully, `InvalidBoundUpdateInfo` if a conflict was encountered.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">prez_lit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">signed_var</span><span class="o">.</span><span class="n">var</span><span class="p">)</span>

        <span class="c1"># If the variable is absent (i.e. its presence literal is false),</span>
        <span class="c1"># the update is useless. Thus we return False.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">prez_lit</span><span class="o">.</span><span class="n">negated</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Similarly, the update is useless when new candidate bound value</span>
        <span class="c1"># is weaker than the current bound value. Thus we return False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">signed_var</span><span class="p">)</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">bound_value</span><span class="p">):</span>     
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># If the new candidate bound value leads to an empty domain:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">signed_var</span><span class="o">.</span><span class="n">opposite</span><span class="p">))</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">bound_value</span><span class="p">):</span>

            <span class="c1"># When the variable is not optional (i.e. always</span>
            <span class="c1"># present), this the conflict is unavoidable.</span>
            <span class="k">if</span> <span class="n">prez_lit</span> <span class="o">==</span> <span class="n">TRUE_LIT</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">InvalidBoundUpdateInfo</span><span class="p">(</span><span class="n">Lit</span><span class="p">(</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">bound_value</span><span class="p">),</span> <span class="n">cause</span><span class="p">)</span>

            <span class="c1"># When the variable is optional, we have to make it absent to avoid</span>
            <span class="c1"># the conflict. Thus we attempt to set its presence literal to false. </span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_literal</span><span class="p">(</span><span class="n">prez_lit</span><span class="o">.</span><span class="n">negated</span><span class="p">,</span>
                                        <span class="n">Causes</span><span class="o">.</span><span class="n">EmptyDomain</span><span class="p">(</span><span class="n">Lit</span><span class="p">(</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">bound_value</span><span class="p">),</span> <span class="n">cause</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># The update is not useless and is valid. It is pushed to the trail</span>
            <span class="c1"># of events, and information on the previous bound is recorded.</span>

            <span class="n">ev</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signed_var</span><span class="p">,</span>
                       <span class="n">bound_value</span><span class="p">,</span>
                       <span class="n">previous_bound_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">signed_var</span><span class="p">),</span>
                       <span class="n">index</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decision_level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_events_at_current_decision_level</span><span class="p">),</span>
                       <span class="n">previous_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_bound_values_event_indices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">signed_var</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                       <span class="n">cause</span><span class="o">=</span><span class="n">cause</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">decision_level</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">[</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">bound_value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values_event_indices</span><span class="p">[</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">index</span>

            <span class="k">if</span> <span class="n">prez_lit</span> <span class="o">!=</span> <span class="n">TRUE_LIT</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="c1"># If the variable is not optional, we can perform &quot;implication</span>
            <span class="c1"># propagation&quot; of this new bound update to other (non optional)</span>
            <span class="c1"># variables. Indeed, only non-optional variables are allowed</span>
            <span class="c1"># in the implication graph.</span>
            <span class="c1">#</span>
            <span class="c1"># This propagation is done by looping through the direct</span>
            <span class="c1"># implications of all events / updates pushed to the</span>
            <span class="c1"># trail since this method was called.</span>
            <span class="c1">#</span>
            <span class="c1"># The bound update will succeed only if implication propagation</span>
            <span class="c1"># is successful. A conflict will be returned otherwise.</span>

            <span class="n">pending_lit</span> <span class="o">=</span> <span class="n">Lit</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">ev</span><span class="o">.</span><span class="n">new_bound_value</span><span class="p">)</span>

            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_events_at_current_decision_level</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>

            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">j</span><span class="p">:</span>

                <span class="n">pending_lit</span> <span class="o">=</span> <span class="n">Lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">decision_level</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">decision_level</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">new_bound_value</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">implied_lit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_optionals_implication_graph</span><span class="o">.</span><span class="n">elements_guarded_by</span><span class="p">(</span><span class="n">pending_lit</span><span class="p">):</span>

                    <span class="c1"># If the implied literal&#39;s bound is weaker than its</span>
                    <span class="c1"># current one, then the update is useless for it.</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">)</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">bound_value</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="c1"># If the implied literal&#39;s variable&#39;s domain is lead to be empty, propagation</span>
                    <span class="c1"># is unsuccessful and a conflict indicating the implied literal as the cause</span>
                    <span class="c1"># for failure is returned. Because we know the var of the implied literal to</span>
                    <span class="c1"># be non-optional, it cannot be made absent to resolve the problem.</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="o">.</span><span class="n">opposite</span><span class="p">))</span>
                        <span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">bound_value</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="k">return</span> <span class="n">InvalidBoundUpdateInfo</span><span class="p">(</span><span class="n">implied_lit</span><span class="p">,</span> <span class="n">cause</span><span class="p">)</span>

                    <span class="c1"># The update to the implied literal&#39;s variable&#39;s bound is not useless and is valid.</span>
                    <span class="c1"># It is pushed to the trail of events, and information on the previous bound is recorded.</span>

                    <span class="k">assert</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_events_at_current_decision_level</span>

                    <span class="n">ev</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span>
                               <span class="n">implied_lit</span><span class="o">.</span><span class="n">bound_value</span><span class="p">,</span>
                               <span class="n">previous_bound_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">),</span>
                               <span class="n">index</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decision_level</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                               <span class="n">previous_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_bound_values_event_indices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                               <span class="n">cause</span><span class="o">=</span><span class="n">Causes</span><span class="o">.</span><span class="n">ImplicationPropagation</span><span class="p">(</span><span class="n">pending_lit</span><span class="p">))</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">decision_level</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">[</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">implied_lit</span><span class="o">.</span><span class="n">bound_value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values_event_indices</span><span class="p">[</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">index</span>

                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># TODO: minimal domain size for uncontrollable variables ?</span>
    <span class="c1"># (it could be defined by a variable itself, since this minimal domain size depends on the presence of uncontrollable edges/links (stnu))</span>

    <span class="c1">#############################################################################</span>
    <span class="c1"># GENERAL HELPER METHODS</span>
    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">_register_implication_between_literals_on_non_optional_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">lit_from</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
        <span class="n">lit_to</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds an implication between two literals (defined on</span>
<span class="sd">        non-optional variables) to the solver.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">lit_from</span><span class="o">.</span><span class="n">signed_var</span><span class="o">.</span><span class="n">var</span><span class="p">)</span> <span class="o">!=</span> <span class="n">TRUE_LIT</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">lit_to</span><span class="o">.</span><span class="n">signed_var</span><span class="o">.</span><span class="n">var</span><span class="p">)</span> <span class="o">!=</span> <span class="n">TRUE_LIT</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;Only implications between non-optional &quot;</span><span class="p">,</span>
                              <span class="s2">&quot;variables are supported&quot;</span><span class="p">))</span>

        <span class="c1"># If the implication is implicit/obvious, no need to add it.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lit_to</span> <span class="o">==</span> <span class="n">TRUE_LIT</span>
            <span class="ow">or</span> <span class="n">lit_from</span> <span class="o">==</span> <span class="n">FALSE_LIT</span>
            <span class="ow">or</span> <span class="n">lit_from</span><span class="o">.</span><span class="n">entails</span><span class="p">(</span><span class="n">lit_to</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">pass</span>

        <span class="c1"># Otherwise, add the implication to the implication graph</span>
        <span class="c1"># (both from =&gt; to and (not to) =&gt; (not from))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_non_optionals_implication_graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">lit_to</span><span class="p">,</span>
                                                      <span class="n">literal</span><span class="o">=</span><span class="n">lit_from</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_non_optionals_implication_graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">lit_from</span><span class="o">.</span><span class="n">negated</span><span class="p">,</span>
                                                      <span class="n">literal</span><span class="o">=</span><span class="n">lit_to</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>

        <span class="c1"># If from_literal is true, to_literal needs to be enforced as true.</span>
        <span class="c1"># (Indeed (from =&gt; to) &lt;=&gt; ((not from) or to))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">lit_from</span><span class="p">):</span>

            <span class="n">bound_update_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_literal</span><span class="p">(</span><span class="n">lit_to</span><span class="p">,</span>
                                                   <span class="n">Causes</span><span class="o">.</span><span class="n">ImplicationPropagation</span><span class="p">(</span><span class="n">lit_from</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bound_update_result</span><span class="p">,</span> <span class="n">InvalidBoundUpdateInfo</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;Inconsistency on the addition of the &quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;implication </span><span class="si">{0}</span><span class="s2"> =&gt; </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lit_from</span><span class="p">,</span> <span class="n">lit_to</span><span class="p">)))</span>

        <span class="c1"># If to_literal is false, from_literal needs to be enforced as false.</span>
        <span class="c1"># (Indeed ((not to) =&gt; (not from)) &lt;=&gt; (to or (not from)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">lit_to</span><span class="o">.</span><span class="n">negated</span><span class="p">):</span>

            <span class="n">bound_update_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_bound_value</span><span class="p">(</span><span class="n">lit_from</span><span class="o">.</span><span class="n">negated</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span>
                                                       <span class="n">lit_from</span><span class="o">.</span><span class="n">negated</span><span class="o">.</span><span class="n">bound_value</span><span class="p">,</span>
                                                       <span class="n">Causes</span><span class="o">.</span><span class="n">ImplicationPropagation</span><span class="p">(</span><span class="n">lit_to</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bound_update_result</span><span class="p">,</span> <span class="n">InvalidBoundUpdateInfo</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;Inconsistency on the addition of the &quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;implication </span><span class="si">{0}</span><span class="s2"> =&gt; </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lit_from</span><span class="p">,</span> <span class="n">lit_to</span><span class="p">)))</span>

    <span class="c1">## # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_register_new_scope_after_sorting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">scope_as_conjunction</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span>
        <span class="n">scope_lit</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        First, sorts the given literals, then adds to the solver a conjunctive </span>
<span class="sd">        scope consisting of them, and corresponding to the given scope literal</span>
<span class="sd">        (i.e. it is true iff all the literals are).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">scope_as_conjunction_sorted</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">scope_as_conjunction</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">scope_as_conjunction_sorted</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_lits_of_lit_conjs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not insert a new scope because it already exists.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_lits_of_lit_conjs</span><span class="p">[</span><span class="n">scope_as_conjunction_sorted</span><span class="p">]</span> <span class="o">=</span> <span class="n">scope_lit</span>

        <span class="c1"># NOTE: The absence of the &quot;not in&quot; condition was causing a bug !</span>
        <span class="c1">#</span>
        <span class="c1"># REVIEW: The collection `_scope_representatives` pairs up two associated</span>
        <span class="c1"># different kinds of &quot;representatives&quot; (as in the notion of</span>
        <span class="c1"># equivalence class) of a scope: its &quot;scope literal&quot; and its</span>
        <span class="c1"># *defining* conjunction of literals.</span>
        <span class="c1"># Together with the `_scopes` collection, this allows to</span>
        <span class="c1"># &quot;bind&quot; different conjunctions falling in the same scope.</span>
        <span class="c1">#</span>
        <span class="c1"># Ideally, we&#39;d like each scope literal to point to</span>
        <span class="c1"># the smallest conjunction defining the scope.</span>
        <span class="k">if</span> <span class="n">scope_lit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_representative_lit_conjs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_representative_lit_conjs</span><span class="p">[</span><span class="n">scope_lit</span><span class="p">]</span> <span class="o">=</span> <span class="n">scope_as_conjunction_sorted</span>

    <span class="c1">## # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_add_new_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_domain</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">controllable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">presence_literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Var</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function for higher level functions that add a new variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">presence_literal</span><span class="o">.</span><span class="n">signed_var</span><span class="o">.</span><span class="n">var</span><span class="p">)</span> <span class="o">!=</span> <span class="n">TRUE_LIT</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;The presence literal of an optional variable must &quot;</span><span class="p">,</span> 
                              <span class="s2">&quot;not be based on an optional variable.&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vars_id_counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">var</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vars_id_counter</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vars</span><span class="p">[</span><span class="n">controllable</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_presence_literals</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">presence_literal</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">[</span><span class="n">SignedVar</span><span class="o">.</span><span class="n">minus</span><span class="p">(</span><span class="n">var</span><span class="p">)]</span> <span class="o">=</span> <span class="n">BoundVal</span><span class="p">(</span><span class="o">-</span><span class="n">initial_domain</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">[</span><span class="n">SignedVar</span><span class="o">.</span><span class="n">plus</span><span class="p">(</span><span class="n">var</span><span class="p">)]</span> <span class="o">=</span> <span class="n">BoundVal</span><span class="p">(</span><span class="n">initial_domain</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">var</span>

    <span class="c1">#############################################################################</span>
    <span class="c1"># CONSTRAINT ADDITION HELPER METHODS</span>
    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">_add_elem_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">elem_constr_expr</span><span class="p">:</span> <span class="n">ElemConstrExpr</span><span class="p">,</span>
        <span class="n">scope_tautology_lit</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ElemConstrExpr</span><span class="p">,</span> <span class="n">Lit</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See `solver.py` `add_constraint` for more</span>
<span class="sd">        general documentation on constraint addition.</span>

<span class="sd">        We have to &quot;bind&quot; `elem_constr_expr` with `scope_tautology_lit` (i.e.</span>
<span class="sd">        reigster the fact that `elem_constr_expr` must be true/satisfied iff</span>
<span class="sd">        the current scope is inside the scope defined by `scope_as_conjunction`).</span>

<span class="sd">        This is done by finding a suitable reification literal</span>
<span class="sd">        for `elem_constr_expr`. There are 3 possible cases:</span>

<span class="sd">        - `elem_constr_expr` is already reified (which is possible if a constraint</span>
<span class="sd">          decomposed into the same &quot;elementary form&quot; was added earlier, or if it</span>
<span class="sd">          results from &quot;intermediary&quot; reification in `_preprocess_constr_expr_into_elem_form`).</span>
<span class="sd">          In this case, we &quot;unify&quot; the already known reification literal with</span>
<span class="sd">          `scope_tautology_lit` by adding an &quot;artificial&quot; constraint binding them together.</span>

<span class="sd">        - `elem_constr_expr` wasn&#39;t already reified and its own &quot;natural&quot; scope</span>
<span class="sd">          is compatible (i.e. is valid simultaneously) with the scope defined by </span>
<span class="sd">          `scope_as_conjunction`. In this case, we reify `elem_constr_expr`</span>
<span class="sd">          with `scope_tautology_lit`.</span>

<span class="sd">        - `elem_constr_expr` wasn&#39;t already reified, but its own &quot;natural&quot; scope</span>
<span class="sd">          is not compatible (i.e. not valid simultaneously) with the scope defined</span>
<span class="sd">          by `scope_as_conjunction`. In this case, we reify `elem_constr_expr` with</span>
<span class="sd">          a new reification literal, but also &quot;unify&quot; it with `scope_tautology_lit` by</span>
<span class="sd">          adding an &quot;artificial&quot; constraint binding them together.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">expr_scope_lit</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_or_make_new_scope_lit_from_conjunction</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_scope_as_conjunction</span><span class="p">(</span><span class="n">elem_constr_expr</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">elem_constr_expr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reifications</span><span class="p">:</span>

            <span class="n">reif_lit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reifications</span><span class="p">[</span><span class="n">elem_constr_expr</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">scope_tautology_lit</span> <span class="o">!=</span> <span class="n">reif_lit</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ElemConstrExpr</span><span class="o">.</span><span class="n">from_lit</span><span class="p">(</span><span class="n">reif_lit</span><span class="p">),</span> <span class="n">scope_tautology_lit</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">expr_scope_lit</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">scope_tautology_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_reifications</span><span class="p">[</span><span class="n">elem_constr_expr</span><span class="p">]</span> <span class="o">=</span> <span class="n">scope_tautology_lit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reifications</span><span class="p">[</span><span class="n">elem_constr_expr</span><span class="o">.</span><span class="n">negated</span><span class="p">]</span> <span class="o">=</span> <span class="n">scope_tautology_lit</span><span class="o">.</span><span class="n">negated</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elem_constr_expr</span><span class="p">,</span> <span class="n">scope_tautology_lit</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">reif_lit</span> <span class="o">=</span> <span class="n">Lit</span><span class="o">.</span><span class="n">geq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_new_variable</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="n">expr_scope_lit</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_reifications</span><span class="p">[</span><span class="n">elem_constr_expr</span><span class="p">]</span> <span class="o">=</span> <span class="n">reif_lit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reifications</span><span class="p">[</span><span class="n">elem_constr_expr</span><span class="o">.</span><span class="n">negated</span><span class="p">]</span> <span class="o">=</span> <span class="n">reif_lit</span><span class="o">.</span><span class="n">negated</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elem_constr_expr</span><span class="p">,</span> <span class="n">reif_lit</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">scope_tautology_lit</span> <span class="o">!=</span> <span class="n">reif_lit</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ElemConstrExpr</span><span class="o">.</span><span class="n">from_lit</span><span class="p">(</span><span class="n">reif_lit</span><span class="p">),</span> <span class="n">scope_tautology_lit</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">elem_constr_expr</span><span class="p">,</span> <span class="n">scope_tautology_lit</span><span class="p">)</span>

    <span class="c1">## # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_get_or_make_new_scope_lit_from_conjunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">scope_as_conjunction</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lit</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a literal representing the scope defined by the given conjunction of</span>
<span class="sd">        literals. If there isn&#39;t already a scope literal like that, add it to the solver.</span>

<span class="sd">        In other words, if we denote the literals of the conjunction as `l_i`, then</span>
<span class="sd">        the scope literal is defined to satisfy `scope_lit &lt;=&gt; l_1 &amp; l_2 &amp; ... &amp; l_n`.</span>

<span class="sd">        Args:</span>
<span class="sd">            scope_as_conjunction: A conjunction of literals defining a scope.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A literal (sometimes called scope literal) representing the scope   \</span>
<span class="sd">                defined by `scope_as_conjunction`. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">scope_as_conjunction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_lits_of_lit_conjs</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_lits_of_lit_conjs</span><span class="p">[</span><span class="n">scope_as_conjunction</span><span class="p">]</span>

        <span class="c1"># If scope is not already known we need to register </span>
        <span class="c1"># with a new literal. There are 2 possibilities:</span>
        <span class="c1">#</span>
        <span class="c1"># - If we find a literal that simplifies the</span>
        <span class="c1">#   conjunction, it will be our scope literal.</span>
        <span class="c1">#</span>
        <span class="c1"># - Otherwise, we create the scope literal from scratch, as a new literal `l`:</span>
        <span class="c1">#   `l =&gt; l_1, l =&gt; l_2, ..., l =&gt; l_n`, and `l | not l_1 | not l_2 | ... | not l_n`</span>
        <span class="c1">#   (which is equivalent to `l &lt;=&gt; l_1 &amp; l_2 &amp; ... &amp; l_n`)</span>

        <span class="n">simplification</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scope_as_conjunction</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">simplification</span> <span class="o">=</span> <span class="n">scope_as_conjunction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">scope_as_conjunction</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

            <span class="c1"># If l_1 =&gt; l_2, the conjunction can be simplified to l_1</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_implication_true</span><span class="p">(</span><span class="n">scope_as_conjunction</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="n">scope_as_conjunction</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">):</span>
                <span class="n">simplification</span> <span class="o">=</span> <span class="n">scope_as_conjunction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># If l_2 =&gt; l_1, the conjunction can be simplified to l_2</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_implication_true</span><span class="p">(</span><span class="n">scope_as_conjunction</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                           <span class="n">scope_as_conjunction</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">):</span>
                <span class="n">simplification</span> <span class="o">=</span> <span class="n">scope_as_conjunction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1">#If l_1 and l_2 are exclusive (i.e. cannot be true at the same</span>
            <span class="c1"># time, i.e. l_1 =&gt; not l_2), then the scope literal is false.</span>
            <span class="c1"># However, we cannot directly use FALSE_LIT, because we</span>
            <span class="c1"># need to uniquely identify the literal as the conjunction</span>
            <span class="c1"># of the other two in some corner cases.</span>
            <span class="c1"># So we create a new literal that is always false.</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_implication_true</span><span class="p">(</span><span class="n">scope_as_conjunction</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="n">scope_as_conjunction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">simplification</span> <span class="o">=</span> <span class="n">Lit</span><span class="o">.</span><span class="n">geq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_new_variable</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="n">TRUE_LIT</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">simplification</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_register_new_scope_after_sorting</span><span class="p">(</span><span class="n">scope_as_conjunction</span><span class="p">,</span> <span class="n">simplification</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">simplification</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">scope_lit</span> <span class="o">=</span> <span class="n">Lit</span><span class="o">.</span><span class="n">geq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_new_variable</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="n">TRUE_LIT</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">lits</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">scope_lit</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">scope_as_conjunction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_register_implication_between_literals_on_non_optional_vars</span><span class="p">(</span><span class="n">scope_lit</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
                <span class="n">lits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_add_elem_constraint</span><span class="p">(</span><span class="n">ElemConstrExpr</span><span class="o">.</span><span class="n">from_lits_simplify_or</span><span class="p">(</span><span class="n">lits</span><span class="p">),</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_scope_tautologies</span><span class="p">[</span><span class="n">TRUE_LIT</span><span class="p">])</span>           
                                      <span class="c1"># we know that self._scopes_tautologies[TRUE_LIT] = TRUE_LIT,</span>
                                      <span class="c1"># but we also keep it explicit for clarity</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_register_new_scope_after_sorting</span><span class="p">(</span><span class="n">scope_as_conjunction</span><span class="p">,</span> <span class="n">scope_lit</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">scope_lit</span>

    <span class="c1">## # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_get_scope_as_conjunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">elem_constr_expr</span><span class="p">:</span> <span class="n">ElemConstrExpr</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns literals whose conjunction defines the scope</span>
<span class="sd">        of the given elementary constraint expression.</span>

<span class="sd">        Args:</span>
<span class="sd">            elem_constr_expr: The elementary constraint expression whose scope we want.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A conjunction of literals which defines the scope of `elem_constr_expr`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">raw_required_presences</span><span class="p">,</span> <span class="n">raw_guards</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_raw_required_presences_and_guards</span><span class="p">(</span><span class="n">elem_constr_expr</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_raw_required_presences_and_guards</span><span class="p">(</span><span class="n">raw_required_presences</span><span class="p">,</span> <span class="n">raw_guards</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1">## # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_get_raw_required_presences_and_guards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">elem_constr_expr</span><span class="p">:</span> <span class="n">ElemConstrExpr</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a special representation of the scope of the given elementary</span>
<span class="sd">        expression, depending on its kind, in the following tuple form:</span>

<span class="sd">        - 1st element (&quot;required presences&quot;): set of presence literals that</span>
<span class="sd">        appear in the expression.</span>

<span class="sd">        - 2nd element (&quot;guards&quot;): set of literals such that if one of them is</span>
<span class="sd">        true, the expression is valid/well-defined.</span>

<span class="sd">        Note that the required presences are &quot;raw&quot;: tautological and multiple</span>
<span class="sd">        literals on the same signed variable are allowed. They will be</span>
<span class="sd">        processed by the `_process_raw_required_presences_and_guards` function.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">match</span> <span class="n">elem_constr_expr</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">elem_constr_expr</span><span class="o">.</span><span class="n">terms</span><span class="p">:</span>

            <span class="k">case</span> <span class="n">ElemConstrExpr</span><span class="o">.</span><span class="n">Kind</span><span class="o">.</span><span class="n">LIT</span><span class="p">,</span> <span class="n">Lit</span><span class="p">()</span> <span class="k">as</span> <span class="n">lit</span><span class="p">:</span>

                <span class="n">prez_lit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="o">.</span><span class="n">var</span><span class="p">)</span>

                <span class="k">return</span> <span class="p">(</span><span class="n">prez_lit</span><span class="p">,),</span> <span class="p">()</span>

            <span class="k">case</span><span class="w"> </span><span class="n">ElemConstrExpr</span><span class="o">.</span><span class="n">Kind</span><span class="o">.</span><span class="n">OR</span><span class="p">,</span> <span class="p">[</span><span class="n">Lit</span><span class="p">(),</span> <span class="o">*</span><span class="k">_</span><span class="p">]</span> <span class="k">as</span> <span class="n">lits</span><span class="p">:</span>

                <span class="k">return</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="o">.</span><span class="n">var</span><span class="p">)</span> <span class="k">for</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">lits</span><span class="p">),</span>
                        <span class="nb">tuple</span><span class="p">(</span><span class="n">lit</span> <span class="k">for</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">lits</span> 
                              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="o">.</span><span class="n">var</span><span class="p">)</span> <span class="o">==</span> <span class="n">TRUE_LIT</span>
                                 <span class="ow">and</span> <span class="n">lit</span> <span class="o">!=</span> <span class="n">FALSE_LIT</span><span class="p">))</span>

            <span class="k">case</span><span class="w"> </span><span class="n">ElemConstrExpr</span><span class="o">.</span><span class="n">Kind</span><span class="o">.</span><span class="n">AND</span><span class="p">,</span> <span class="p">[</span><span class="n">Lit</span><span class="p">(),</span> <span class="o">*</span><span class="k">_</span><span class="p">]</span> <span class="k">as</span> <span class="n">lits</span><span class="p">:</span>

                <span class="k">return</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="o">.</span><span class="n">var</span><span class="p">)</span> <span class="k">for</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">lits</span><span class="p">),</span>
                        <span class="nb">tuple</span><span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">negated</span> <span class="k">for</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">lits</span> 
                              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="o">.</span><span class="n">var</span><span class="p">)</span> <span class="o">==</span> <span class="n">TRUE_LIT</span>
                                 <span class="ow">and</span> <span class="n">lit</span><span class="o">.</span><span class="n">negated</span> <span class="o">!=</span> <span class="n">FALSE_LIT</span><span class="p">))</span>

            <span class="k">case</span> <span class="p">(</span><span class="n">ElemConstrExpr</span><span class="o">.</span><span class="n">Kind</span><span class="o">.</span><span class="n">MAX_DIFFERENCE</span><span class="p">,</span>
                <span class="p">(</span><span class="n">Var</span><span class="p">()</span> <span class="k">as</span> <span class="n">var_from</span><span class="p">,</span> <span class="n">Var</span><span class="p">()</span> <span class="k">as</span> <span class="n">var_to</span><span class="p">,</span> <span class="nb">int</span><span class="p">())</span>
            <span class="p">):</span>
                <span class="n">prez_lit_var_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">var_from</span><span class="p">)</span>
                <span class="n">prez_lit_var_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">var_to</span><span class="p">)</span>

                <span class="k">return</span> <span class="p">(</span><span class="n">prez_lit_var_from</span><span class="p">,</span> <span class="n">prez_lit_var_to</span><span class="p">),</span> <span class="p">()</span>

            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span>

    <span class="c1">## # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_process_raw_required_presences_and_guards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">raw_required_presences</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span>
        <span class="n">guards</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span>
        <span class="n">only_remove_lits_entailed_at_top_decision_level</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;Flattens&quot; / processes &quot;raw&quot; required presences and guards obtained from </span>
<span class="sd">        `_get_raw_required_presences_and_guards`.</span>

<span class="sd">        This is done by:</span>

<span class="sd">        1. Keeping only the strongest literals of the &quot;raw&quot; required presences.</span>

<span class="sd">        2. Replacing literals defined as a conjunction of other literals by</span>
<span class="sd">        that conjunction (using `_scope_representative_lit_conjs`)</span>

<span class="sd">        3. Keeping non-tautological literals (i.e. non entailed ones).</span>

<span class="sd">        4. Keeping non-guarded literals (i.e. removing the literals that</span>
<span class="sd">        are contradicting a literal from &quot;guards&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="k">def</span> <span class="nf">is_tautology</span><span class="p">(</span><span class="n">lit</span><span class="p">:</span> <span class="n">Lit</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">lit</span><span class="p">):</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">only_remove_lits_entailed_at_top_decision_level</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">first_entailing_ev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_event_entailing</span><span class="p">(</span><span class="n">lit</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">first_entailing_ev</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">first_entailing_ev</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>

            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

        <span class="n">required_presences</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>

        <span class="k">for</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">raw_required_presences</span><span class="p">:</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">required_presences</span>
                <span class="ow">or</span> <span class="n">lit</span><span class="o">.</span><span class="n">bound_value</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">required_presences</span><span class="p">[</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">])</span>
            <span class="p">):</span>
                <span class="n">required_presences</span><span class="p">[</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">lit</span><span class="o">.</span><span class="n">bound_value</span>

        <span class="k">for</span> <span class="n">signed_var</span><span class="p">,</span> <span class="n">bound_value</span> <span class="ow">in</span> <span class="n">required_presences</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="n">lit</span> <span class="o">=</span> <span class="n">Lit</span><span class="p">(</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">bound_value</span><span class="p">)</span>
            <span class="n">lits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_representative_lit_conjs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lit</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">lits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lits</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">is_tautology</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">signed_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">required_presences</span>
                        <span class="ow">or</span> <span class="n">l</span><span class="o">.</span><span class="n">bound_value</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">required_presences</span><span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">signed_var</span><span class="p">])</span>
                    <span class="p">):</span>
                        <span class="n">required_presences</span><span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">bound_value</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">is_tautology</span><span class="p">(</span><span class="n">lit</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">required_presences</span>
                    <span class="ow">or</span> <span class="n">lit</span><span class="o">.</span><span class="n">bound_value</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">required_presences</span><span class="p">[</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">])</span>
                <span class="p">):</span>
                    <span class="n">required_presences</span><span class="p">[</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">lit</span><span class="o">.</span><span class="n">bound_value</span>

        <span class="k">for</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">guards</span><span class="p">:</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span> <span class="ow">in</span> <span class="n">required_presences</span>
                <span class="ow">and</span> <span class="n">lit</span><span class="o">.</span><span class="n">negated</span><span class="o">.</span><span class="n">bound_value</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">required_presences</span><span class="p">[</span><span class="n">lit</span><span class="o">.</span><span class="n">negated</span><span class="o">.</span><span class="n">signed_var</span><span class="p">])</span>
            <span class="p">):</span>
                <span class="n">weaker</span> <span class="o">=</span> <span class="n">Lit</span><span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">lit</span><span class="o">.</span><span class="n">bound_value</span> <span class="o">+</span> <span class="n">BoundVal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">is_tautology</span><span class="p">(</span><span class="n">weaker</span><span class="p">):</span>
                    <span class="n">required_presences</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">required_presences</span><span class="p">[</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">weaker</span><span class="o">.</span><span class="n">bound_value</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">Lit</span><span class="p">(</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">bound_value</span><span class="p">)</span> 
                            <span class="k">for</span> <span class="n">signed_var</span><span class="p">,</span> <span class="n">bound_value</span> <span class="ow">in</span> <span class="n">required_presences</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

    <span class="c1">## # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="k">def</span> <span class="nf">_get_or_make_tautology_of_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">scope_lit</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lit</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a literal whose presence status must be equal</span>
<span class="sd">        to the truth value of the given literal.</span>

<span class="sd">        This is functionally equivalent to creating a new optional variable with</span>
<span class="sd">        a domain consisting of the single value 1, and ensuring that only one</span>
<span class="sd">        such variable is created in the scope represented by `scope_lit`.</span>

<span class="sd">        Indeed, TRUE_LIT cannot be used for this in general, because its</span>
<span class="sd">        variable, (the special ZERO_VAR variable) is always present (i.e. is</span>
<span class="sd">        present in all scopes, not just the one represented by `scope_lit`).</span>

<span class="sd">        Args:</span>
<span class="sd">            scope_lit: A scope literal representing a scope.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The so-called tautology literal for the scope represented by `scope_lit`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">scope_lit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_tautologies</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_tautologies</span><span class="p">[</span><span class="n">scope_lit</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">lit</span> <span class="o">=</span> <span class="n">Lit</span><span class="o">.</span><span class="n">geq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_new_variable</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="n">scope_lit</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_tautologies</span><span class="p">[</span><span class="n">scope_lit</span><span class="p">]</span> <span class="o">=</span> <span class="n">lit</span>
            <span class="k">return</span> <span class="n">lit</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">





<h5 id="src.solver.solver_state.SolverState-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.solver_state.SolverState.decision_level" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">decision_level</span><span class="p">:</span> <span class="nb">int</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  
      <p>The current decision level of the solver.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h6 id="src.solver.solver_state.SolverState.num_events_at_current_decision_level" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">num_events_at_current_decision_level</span><span class="p">:</span> <span class="nb">int</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  
      <p>The number of events at the current decision level.</p>
  </div>

</div>

<h5 id="src.solver.solver_state.SolverState-functions">Functions</h5>


<div class="doc doc-object doc-function">




<h6 id="src.solver.solver_state.SolverState.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h6>


  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>src/solver/solver_state.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_vars_id_counter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_vars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">Var</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span> <span class="kc">False</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="p">}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stores all the variables known to the solver.</span>

<span class="sd">    The controllable variables are in the set under key True,</span>
<span class="sd">    and the uncontrollable ones are in the set under key False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_presence_literals</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Var</span><span class="p">,</span> <span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps variables to their presence literals.</span>

<span class="sd">    Variables of presence literals have to be non-optional</span>
<span class="sd">    (i.e. have the TRUE_LIT as their presence literal).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_non_optionals_implication_graph</span><span class="p">:</span> <span class="n">SetGuardedByLiterals</span><span class="p">[</span><span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="n">SetGuardedByLiterals</span><span class="p">()</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents an implication graph on literals of non-optional variables</span>
<span class="sd">    (most notably presence literals).</span>

<span class="sd">    An implication [svar1 &lt;= a] =&gt; [svar2 &lt;= b] is encoded as:</span>
<span class="sd">    { svar1 : { a : [svar2 &lt;= b] } }. As such, if we want to check if</span>
<span class="sd">    [svar1 &lt;= c] implies [svar2 &lt;= d], we iterate through guard values</span>
<span class="sd">    weaker (&gt;=) than c, and search for any literal entailing [svar2 &lt;= d]</span>
<span class="sd">    (i.e. on the same signed variable (svar2) and with weaker (&gt;=) bound than d).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">SignedVar</span><span class="p">,</span> <span class="n">BoundVal</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The main &quot;domains&quot; structure.</span>
<span class="sd">    Stores the upper and lower bounds of variables&#39; domains (at the current decision level).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_dec_lvl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The current decision level of the solver.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Event</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[]]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The trail of events.</span>

<span class="sd">    Uses double indices: the index in outer list is the decision level of the event.</span>
<span class="sd">    The index in the inner list is the index of the event in that decision level.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values_event_indices</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">SignedVar</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stores the indices in `events_trail` of events that set the (current) bounds of variables.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_lits_of_lit_conjs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stores conjunctions of (presence) literals corresponding to (conjunctive)</span>
<span class="sd">    scopes that have been defined in the problem, as well as the associated</span>
<span class="sd">    &quot;scope literals&quot; representing them.</span>

<span class="sd">    A conjunctive scope is created when we want to refer to a subset of the</span>
<span class="sd">    problem that exists iff all required scopes are present. For example, the </span>
<span class="sd">    expression &quot;a &lt;= b&quot; is defined iff both a and b are present. It can be said</span>
<span class="sd">    to exist in the conjunctive scope &quot;presence(a) &amp; presence(b)&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_representative_lit_conjs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span><span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The reverse of `scopes`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_tautologies</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Lit</span><span class="p">,</span> <span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For each scope literal, associates a literal (on an optional variable).</span>
<span class="sd">    When we&#39;re in that scope (i.e. the scope literal is true, i.e. all the</span>
<span class="sd">    literals defining it are true) that literal is always true. When we&#39;re</span>
<span class="sd">    not in that scope, the variable of this literal is absent. As such, this</span>
<span class="sd">    literal can indeed be called &quot;tautology of the scope&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">ElemConstrExpr</span><span class="p">,</span> <span class="n">Lit</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stores pairs consisting of a constraint (in elementary form) and a literal,</span>
<span class="sd">    stating that the literal must be true iff the constraint is true.</span>

<span class="sd">    REVIEW? Both &quot;real&quot; reified constraints that were defined in the problem</span>
<span class="sd">    and &quot;artificial&quot;/&quot;intermediary&quot; constraints can be found here.</span>
<span class="sd">    Apart from pairs consisting of a (reified) constraint and its reification</span>
<span class="sd">    literal, there can be pairs where the constraint is simply the satisfaction</span>
<span class="sd">    of a reification literal of another constraint. This allows to enforce</span>
<span class="sd">    a sort of &quot;chain of constraints&quot;. REVIEW?</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_reifications</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ElemConstrExpr</span><span class="p">,</span> <span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stores reification literals of constraints that were defined in the problem (in</span>
<span class="sd">    their &quot;elementary&quot; form) and reified.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_vars</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ZERO_VAR</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_presence_literals</span><span class="p">[</span><span class="n">ZERO_VAR</span><span class="p">]</span> <span class="o">=</span> <span class="n">TRUE_LIT</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">[</span><span class="n">SignedVar</span><span class="o">.</span><span class="n">plus</span><span class="p">(</span><span class="n">ZERO_VAR</span><span class="p">)]</span> <span class="o">=</span> <span class="n">BoundVal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">[</span><span class="n">SignedVar</span><span class="o">.</span><span class="n">minus</span><span class="p">(</span><span class="n">ZERO_VAR</span><span class="p">)]</span> <span class="o">=</span> <span class="n">BoundVal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_lits_of_lit_conjs</span><span class="p">[()]</span> <span class="o">=</span> <span class="n">TRUE_LIT</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_representative_lit_conjs</span><span class="p">[</span><span class="n">TRUE_LIT</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_tautologies</span><span class="p">[</span><span class="n">TRUE_LIT</span><span class="p">]</span> <span class="o">=</span> <span class="n">TRUE_LIT</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.solver_state.SolverState.bound_value_of" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">bound_value_of</span><span class="p">(</span><span class="n">signed_var</span><span class="p">:</span> <span class="n">SignedVar</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoundVal</span></code>

</h6>


  <div class="doc doc-contents ">
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>signed_var</b>
            (<code><a class="autorefs autorefs-internal" title="src.fundamentals.SignedVar" href="../fundamentals/#src.fundamentals.SignedVar">SignedVar</a></code>)
        
        <div class="doc-md-description">
          <p>The signed variable whose bound to get.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-internal" title="src.fundamentals.BoundVal" href="../fundamentals/#src.fundamentals.BoundVal">BoundVal</a></code>
        
        <div class="doc-md-description">
          <p>The current bound of <code>signed_var</code>.</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>src/solver/solver_state.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bound_value_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">signed_var</span><span class="p">:</span> <span class="n">SignedVar</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoundVal</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        signed_var: The signed variable whose bound to get.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The current bound of `signed_var`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">[</span><span class="n">signed_var</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.solver_state.SolverState.presence_literal_of" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">Var</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lit</span></code>

</h6>


  <div class="doc doc-contents ">
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>var</b>
            (<code><a class="autorefs autorefs-internal" title="src.fundamentals.Var" href="../fundamentals/#src.fundamentals.Var">Var</a></code>)
        
        <div class="doc-md-description">
          <p>The variable whose presence literal to get.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-internal" title="src.fundamentals.Lit" href="../fundamentals/#src.fundamentals.Lit">Lit</a></code>
        
        <div class="doc-md-description">
          <p>The presence literal of <code>var</code>.</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>src/solver/solver_state.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">presence_literal_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">var</span><span class="p">:</span> <span class="n">Var</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lit</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        var: The variable whose presence literal to get.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The presence literal of `var`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_presence_literals</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.solver_state.SolverState.is_entailed" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">is_entailed</span><span class="p">(</span><span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

</h6>


  <div class="doc doc-contents ">
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>literal</b>
            (<code><a class="autorefs autorefs-internal" title="src.fundamentals.Lit" href="../fundamentals/#src.fundamentals.Lit">Lit</a></code>)
        
        <div class="doc-md-description">
          <p>The literal whose entailment to check.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>bool</code>
        
        <div class="doc-md-description">
          <p>Whether <code>literal</code> is entailed at the current decision                   level (i.e. its bound value is weaker than its                      signed variable's current bound).</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>src/solver/solver_state.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_entailed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        literal: The literal whose entailment to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether `literal` is entailed at the current decision   \</span>
<span class="sd">            level (i.e. its bound value is weaker than its      \</span>
<span class="sd">            signed variable&#39;s current bound).</span>
<span class="sd">    &quot;&quot;&quot;</span> 

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">literal</span><span class="o">.</span><span class="n">signed_var</span><span class="p">)</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">literal</span><span class="o">.</span><span class="n">bound_value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.solver_state.SolverState.is_implication_true" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">is_implication_true</span><span class="p">(</span><span class="n">literal_from</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span> <span class="n">literal_to</span><span class="p">:</span> <span class="n">Lit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

</h6>


  <div class="doc doc-contents ">
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>literal_from</b>
            (<code><a class="autorefs autorefs-internal" title="src.fundamentals.Lit" href="../fundamentals/#src.fundamentals.Lit">Lit</a></code>)
        
        <div class="doc-md-description">
          <p>The "source" of the implication to check.</p>
        </div>
      </li>
      <li class="field-body">
        <b>literal_to</b>
            (<code><a class="autorefs autorefs-internal" title="src.fundamentals.Lit" href="../fundamentals/#src.fundamentals.Lit">Lit</a></code>)
        
        <div class="doc-md-description">
          <p>The "target" of the implication to check.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>bool</code>
        
        <div class="doc-md-description">
          <p>Whether the implication <code>literal_from</code> =&gt; <code>literal_to</code> is true.</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>src/solver/solver_state.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_implication_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">literal_from</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="n">literal_to</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        literal_from: The &quot;source&quot; of the implication to check.</span>
<span class="sd">        literal_to: The &quot;target&quot; of the implication to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the implication `literal_from` =&gt; `literal_to` is true.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Obvious cases where the implication is known to be true.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">literal_to</span> <span class="o">==</span> <span class="n">TRUE_LIT</span>
        <span class="ow">or</span> <span class="n">literal_from</span> <span class="o">==</span> <span class="n">FALSE_LIT</span>
        <span class="ow">or</span> <span class="n">literal_from</span><span class="o">.</span><span class="n">entails</span><span class="p">(</span><span class="n">literal_to</span><span class="p">)</span>
        <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">literal_from</span><span class="o">.</span><span class="n">negated</span><span class="p">)</span>
        <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">literal_to</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span> 

    <span class="c1"># When there are no &quot;incoming edges&quot; to `literal_to` in the implication</span>
    <span class="c1"># graph (i.e. &quot;outgoing edges&quot; from `literal_to.negated`), there can&#39;t</span>
    <span class="c1"># be any implications to `literal_to`. Thus we return False.</span>
    <span class="c1"># NOTE: This check is possible because for each (x -&gt; y) &quot;edge&quot; to add</span>
    <span class="c1"># in the implication graph, we also explicitly add a (!y -&gt; !x) &quot;edge&quot;.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_optionals_implication_graph</span><span class="o">.</span><span class="n">has_elements_guarded_by</span><span class="p">(</span><span class="n">literal_to</span><span class="o">.</span><span class="n">negated</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Depth first search through the implication graph, starting</span>
    <span class="c1"># at `literal_from`. Look for a literal that entails `literal_to`</span>
    <span class="c1"># to determine whether `literal_from` implies `literal_to`.</span>

    <span class="n">stack</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Lit</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">literal_from</span><span class="p">]</span>
    <span class="n">visited</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">SignedVar</span><span class="p">,</span> <span class="n">BoundVal</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
        <span class="n">lit</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="c1"># If the current literal entails `literal_to`, then we won:</span>
        <span class="c1"># `literal_to` is reachable from `literal_from`.</span>
        <span class="c1"># Thus `literal_from` does imply `literal_to` and we return True.</span>
        <span class="k">if</span> <span class="n">lit</span><span class="o">.</span><span class="n">entails</span><span class="p">(</span><span class="n">literal_to</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
            <span class="n">visited</span><span class="p">[</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">lit</span><span class="o">.</span><span class="n">bound_value</span>

        <span class="c1"># If we have already visited a literal that entails the</span>
        <span class="c1"># current one, then there is no hope in pursuing the search</span>
        <span class="c1"># further in this path (because the search is depth-first).</span>
        <span class="k">elif</span> <span class="n">lit</span><span class="o">.</span><span class="n">bound_value</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">visited</span><span class="p">[</span><span class="n">lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">]):</span>
            <span class="k">continue</span>                                                    

        <span class="c1"># If the current literal doesn&#39;t imply anything, then it can&#39;t</span>
        <span class="c1"># imply possibly `literal_to`: no hope in pursuing the search</span>
        <span class="c1"># further in this path (because the search is depth-first).</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_optionals_implication_graph</span><span class="o">.</span><span class="n">has_elements_guarded_by</span><span class="p">(</span><span class="n">lit</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="c1"># Push literals &quot;directly implied&quot; by the current literal to the search stack.</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_optionals_implication_graph</span><span class="o">.</span><span class="n">elements_guarded_by</span><span class="p">(</span><span class="n">lit</span><span class="p">))</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.solver_state.SolverState.first_event_entailing" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">first_event_entailing</span><span class="p">(</span><span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Event</span><span class="p">]</span></code>

</h6>


  <div class="doc doc-contents ">
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>literal</b>
            (<code><a class="autorefs autorefs-internal" title="src.fundamentals.Lit" href="../fundamentals/#src.fundamentals.Lit">Lit</a></code>)
        
        <div class="doc-md-description">
          <p>The literal whose first entailing event to find.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="src.solver.common.Event" href="../common/#src.solver.common.Event">Event</a>]</code>
        
        <div class="doc-md-description">
          <p>The earliest first event that makes <code>literal</code> true.</p>
      </div>
      </li>
      <li class="field-body">
            <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="src.solver.common.Event" href="../common/#src.solver.common.Event">Event</a>]</code>
        
        <div class="doc-md-description">
          <p>None if there are no events on <code>literal</code>'s signed variable.</p>
      </div>
      </li>
  </ul>



  <p>Raises:</p>
  <ul>
      <li class="field-body">
            <code>ValueError</code>
          
        <div class="doc-md-description">
          <p>if <code>literal</code> isn't currently entailed.</p>
        </div>
      </li>
  </ul>

<details class="note" open>
  <summary>Note</summary>
  <p>The method works by walking in reverse order through events on
the signed variable of <code>literal</code>. The first event that makes
<code>literal</code> true is the one whose previous value was weaker
than <code>literal</code>'s bound value (i.e. the literal wasn't
entailed before this event).</p>
</details>
          <details class="quote">
            <summary>Source code in <code>src/solver/solver_state.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">first_event_entailing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Event</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        literal: The literal whose first entailing event to find.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The earliest first event that makes `literal` true.</span>
<span class="sd">        None if there are no events on `literal`&#39;s signed variable.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if `literal` isn&#39;t currently entailed.</span>

<span class="sd">    Note:</span>
<span class="sd">        The method works by walking in reverse order through events on</span>
<span class="sd">        the signed variable of `literal`. The first event that makes</span>
<span class="sd">        `literal` true is the one whose previous value was weaker</span>
<span class="sd">        than `literal`&#39;s bound value (i.e. the literal wasn&#39;t</span>
<span class="sd">        entailed before this event).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">literal</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;Literal not entailed: A literal must be entailed &quot;</span><span class="p">,</span>
                          <span class="s2">&quot;to find its first entailing event&quot;</span><span class="p">))</span>

    <span class="n">ev</span><span class="p">:</span> <span class="n">Event</span>

    <span class="n">ev_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values_event_indices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">literal</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">ev_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">dl</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ev_index</span>
        <span class="n">ev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">[</span><span class="n">dl</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">previous_bound_value</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">literal</span><span class="o">.</span><span class="n">bound_value</span><span class="p">):</span>
            <span class="n">ev_index</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">previous_index</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">ev</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.solver_state.SolverState.is_assignment_complete" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">is_assignment_complete</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

</h6>


  <div class="doc doc-contents ">
  
      

          <details class="quote">
            <summary>Source code in <code>src/solver/solver_state.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_assignment_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">SignedVar</span><span class="o">.</span><span class="n">plus</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
                <span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">SignedVar</span><span class="o">.</span><span class="n">minus</span><span class="p">(</span><span class="n">var</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vars</span><span class="p">[</span><span class="kc">True</span><span class="p">]])</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.solver_state.SolverState.set_literal" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_literal</span><span class="p">(</span><span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span> <span class="n">cause</span><span class="p">:</span> <span class="n">Causes</span><span class="o">.</span><span class="n">AnyCause</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">InvalidBoundUpdateInfo</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Syntactic sugar for <code>set_bound_value</code>.</p>

          <details class="quote">
            <summary>Source code in <code>src/solver/solver_state.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_literal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">literal</span><span class="p">:</span> <span class="n">Lit</span><span class="p">,</span>
    <span class="n">cause</span><span class="p">:</span> <span class="n">Causes</span><span class="o">.</span><span class="n">AnyCause</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">InvalidBoundUpdateInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Syntactic sugar for `set_bound_value`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_bound_value</span><span class="p">(</span><span class="n">literal</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">literal</span><span class="o">.</span><span class="n">bound_value</span><span class="p">,</span> <span class="n">cause</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h6 id="src.solver.solver_state.SolverState.set_bound_value" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_bound_value</span><span class="p">(</span><span class="n">signed_var</span><span class="p">:</span> <span class="n">SignedVar</span><span class="p">,</span> <span class="n">bound_value</span><span class="p">:</span> <span class="n">BoundVal</span><span class="p">,</span> <span class="n">cause</span><span class="p">:</span> <span class="n">Causes</span><span class="o">.</span><span class="n">AnyCause</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">InvalidBoundUpdateInfo</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>One of the most (arguably the most) important method of the solver.</p>
<p>Attempts to set a new bound on a signed variable, which is equivalent
to setting / entailing / enforcing the corresponding literal.</p>
<p>When the bound update is useless (the variable is optional and absent,
or the current bound is stronger than the given one), doesn't do
anything and returns False.</p>
<p>When the bound update leads to an empty domain for this given signed
variable's variable, there are 2 possible cases:</p>
<ul>
<li>
<p>If the variable is non-optional, immediately return a <code>InvalidBoundUpdateInfo</code>.</p>
</li>
<li>
<p>If the variable is optional, sets the new bound and attempts to set
the negation of the variable's presence literal with a new call to
<code>set_bound_value</code>. The results of this recursive call are then returned.</p>
</li>
</ul>
<p>If the variable is non-optional, the given new bound is not useless (i.e.
strictly stronger than the current one), and it doesn't make the variable's
domain empty, performs "implication propagation" of this update to literals
on non-optional variables (in the <code>_non_optionals_implication_graph</code>) by
recursively calling <code>set_bound_value</code>. If any of those calls leads to a
failure / invalid bound update, the corresponding <code>InvalidBoundUpdateInfo</code>
will be returned.</p>
<p>Finally, when the bound was was successfully updated without leading to an
empty domain for any variable, True is returned.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>signed_var</b>
            (<code><a class="autorefs autorefs-internal" title="src.fundamentals.SignedVar" href="../fundamentals/#src.fundamentals.SignedVar">SignedVar</a></code>)
        
        <div class="doc-md-description">
          <p>The signed variable whose bound to set.</p>
        </div>
      </li>
      <li class="field-body">
        <b>bound_value</b>
            (<code><a class="autorefs autorefs-internal" title="src.fundamentals.BoundVal" href="../fundamentals/#src.fundamentals.BoundVal">BoundVal</a></code>)
        
        <div class="doc-md-description">
          <p>The bound value to set on <code>signed_var</code>.</p>
        </div>
      </li>
      <li class="field-body">
        <b>cause</b>
            (<code><a class="autorefs autorefs-internal" title="src.solver.common.Causes.AnyCause" href="../common/#src.solver.common.Causes.AnyCause">AnyCause</a></code>)
        
        <div class="doc-md-description">
          <p>The cause for this bound update.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>bool | <a class="autorefs autorefs-internal" title="src.solver.common.InvalidBoundUpdateInfo" href="../common/#src.solver.common.InvalidBoundUpdateInfo">InvalidBoundUpdateInfo</a></code>
        
        <div class="doc-md-description">
          <p>False if the update was useless, True if the update was performed                   successfully, <code>InvalidBoundUpdateInfo</code> if a conflict was encountered.</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>src/solver/solver_state.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_bound_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">signed_var</span><span class="p">:</span> <span class="n">SignedVar</span><span class="p">,</span>
    <span class="n">bound_value</span><span class="p">:</span> <span class="n">BoundVal</span><span class="p">,</span>
    <span class="n">cause</span><span class="p">:</span> <span class="n">Causes</span><span class="o">.</span><span class="n">AnyCause</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">InvalidBoundUpdateInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    One of the most (arguably the most) important method of the solver.</span>

<span class="sd">    Attempts to set a new bound on a signed variable, which is equivalent</span>
<span class="sd">    to setting / entailing / enforcing the corresponding literal.</span>

<span class="sd">    When the bound update is useless (the variable is optional and absent,</span>
<span class="sd">    or the current bound is stronger than the given one), doesn&#39;t do</span>
<span class="sd">    anything and returns False.</span>

<span class="sd">    When the bound update leads to an empty domain for this given signed</span>
<span class="sd">    variable&#39;s variable, there are 2 possible cases:</span>

<span class="sd">    - If the variable is non-optional, immediately return a `InvalidBoundUpdateInfo`.</span>

<span class="sd">    - If the variable is optional, sets the new bound and attempts to set</span>
<span class="sd">    the negation of the variable&#39;s presence literal with a new call to</span>
<span class="sd">    `set_bound_value`. The results of this recursive call are then returned.</span>

<span class="sd">    If the variable is non-optional, the given new bound is not useless (i.e.</span>
<span class="sd">    strictly stronger than the current one), and it doesn&#39;t make the variable&#39;s</span>
<span class="sd">    domain empty, performs &quot;implication propagation&quot; of this update to literals</span>
<span class="sd">    on non-optional variables (in the `_non_optionals_implication_graph`) by</span>
<span class="sd">    recursively calling `set_bound_value`. If any of those calls leads to a</span>
<span class="sd">    failure / invalid bound update, the corresponding `InvalidBoundUpdateInfo`</span>
<span class="sd">    will be returned.</span>

<span class="sd">    Finally, when the bound was was successfully updated without leading to an</span>
<span class="sd">    empty domain for any variable, True is returned.</span>

<span class="sd">    Args:</span>
<span class="sd">        signed_var: The signed variable whose bound to set.</span>
<span class="sd">        bound_value: The bound value to set on `signed_var`.</span>
<span class="sd">        cause: The cause for this bound update.</span>

<span class="sd">    Returns:</span>
<span class="sd">        False if the update was useless, True if the update was performed   \</span>
<span class="sd">            successfully, `InvalidBoundUpdateInfo` if a conflict was encountered.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">prez_lit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presence_literal_of</span><span class="p">(</span><span class="n">signed_var</span><span class="o">.</span><span class="n">var</span><span class="p">)</span>

    <span class="c1"># If the variable is absent (i.e. its presence literal is false),</span>
    <span class="c1"># the update is useless. Thus we return False.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_entailed</span><span class="p">(</span><span class="n">prez_lit</span><span class="o">.</span><span class="n">negated</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Similarly, the update is useless when new candidate bound value</span>
    <span class="c1"># is weaker than the current bound value. Thus we return False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">signed_var</span><span class="p">)</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">bound_value</span><span class="p">):</span>     
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># If the new candidate bound value leads to an empty domain:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">signed_var</span><span class="o">.</span><span class="n">opposite</span><span class="p">))</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">bound_value</span><span class="p">):</span>

        <span class="c1"># When the variable is not optional (i.e. always</span>
        <span class="c1"># present), this the conflict is unavoidable.</span>
        <span class="k">if</span> <span class="n">prez_lit</span> <span class="o">==</span> <span class="n">TRUE_LIT</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">InvalidBoundUpdateInfo</span><span class="p">(</span><span class="n">Lit</span><span class="p">(</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">bound_value</span><span class="p">),</span> <span class="n">cause</span><span class="p">)</span>

        <span class="c1"># When the variable is optional, we have to make it absent to avoid</span>
        <span class="c1"># the conflict. Thus we attempt to set its presence literal to false. </span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_literal</span><span class="p">(</span><span class="n">prez_lit</span><span class="o">.</span><span class="n">negated</span><span class="p">,</span>
                                    <span class="n">Causes</span><span class="o">.</span><span class="n">EmptyDomain</span><span class="p">(</span><span class="n">Lit</span><span class="p">(</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">bound_value</span><span class="p">),</span> <span class="n">cause</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="c1"># The update is not useless and is valid. It is pushed to the trail</span>
        <span class="c1"># of events, and information on the previous bound is recorded.</span>

        <span class="n">ev</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signed_var</span><span class="p">,</span>
                   <span class="n">bound_value</span><span class="p">,</span>
                   <span class="n">previous_bound_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">signed_var</span><span class="p">),</span>
                   <span class="n">index</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decision_level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_events_at_current_decision_level</span><span class="p">),</span>
                   <span class="n">previous_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_bound_values_event_indices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">signed_var</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                   <span class="n">cause</span><span class="o">=</span><span class="n">cause</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">decision_level</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">[</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">bound_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values_event_indices</span><span class="p">[</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">index</span>

        <span class="k">if</span> <span class="n">prez_lit</span> <span class="o">!=</span> <span class="n">TRUE_LIT</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># If the variable is not optional, we can perform &quot;implication</span>
        <span class="c1"># propagation&quot; of this new bound update to other (non optional)</span>
        <span class="c1"># variables. Indeed, only non-optional variables are allowed</span>
        <span class="c1"># in the implication graph.</span>
        <span class="c1">#</span>
        <span class="c1"># This propagation is done by looping through the direct</span>
        <span class="c1"># implications of all events / updates pushed to the</span>
        <span class="c1"># trail since this method was called.</span>
        <span class="c1">#</span>
        <span class="c1"># The bound update will succeed only if implication propagation</span>
        <span class="c1"># is successful. A conflict will be returned otherwise.</span>

        <span class="n">pending_lit</span> <span class="o">=</span> <span class="n">Lit</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span> <span class="n">ev</span><span class="o">.</span><span class="n">new_bound_value</span><span class="p">)</span>

        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_events_at_current_decision_level</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>

        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">j</span><span class="p">:</span>

            <span class="n">pending_lit</span> <span class="o">=</span> <span class="n">Lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">decision_level</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">decision_level</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">new_bound_value</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">implied_lit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_optionals_implication_graph</span><span class="o">.</span><span class="n">elements_guarded_by</span><span class="p">(</span><span class="n">pending_lit</span><span class="p">):</span>

                <span class="c1"># If the implied literal&#39;s bound is weaker than its</span>
                <span class="c1"># current one, then the update is useless for it.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">)</span><span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">bound_value</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="c1"># If the implied literal&#39;s variable&#39;s domain is lead to be empty, propagation</span>
                <span class="c1"># is unsuccessful and a conflict indicating the implied literal as the cause</span>
                <span class="c1"># for failure is returned. Because we know the var of the implied literal to</span>
                <span class="c1"># be non-optional, it cannot be made absent to resolve the problem.</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="o">.</span><span class="n">opposite</span><span class="p">))</span>
                    <span class="o">.</span><span class="n">is_stronger_than</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">bound_value</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="n">InvalidBoundUpdateInfo</span><span class="p">(</span><span class="n">implied_lit</span><span class="p">,</span> <span class="n">cause</span><span class="p">)</span>

                <span class="c1"># The update to the implied literal&#39;s variable&#39;s bound is not useless and is valid.</span>
                <span class="c1"># It is pushed to the trail of events, and information on the previous bound is recorded.</span>

                <span class="k">assert</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_events_at_current_decision_level</span>

                <span class="n">ev</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span>
                           <span class="n">implied_lit</span><span class="o">.</span><span class="n">bound_value</span><span class="p">,</span>
                           <span class="n">previous_bound_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bound_value_of</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">),</span>
                           <span class="n">index</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decision_level</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                           <span class="n">previous_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_bound_values_event_indices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                           <span class="n">cause</span><span class="o">=</span><span class="n">Causes</span><span class="o">.</span><span class="n">ImplicationPropagation</span><span class="p">(</span><span class="n">pending_lit</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_events_trail</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">decision_level</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values</span><span class="p">[</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">implied_lit</span><span class="o">.</span><span class="n">bound_value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bound_values_event_indices</span><span class="p">[</span><span class="n">implied_lit</span><span class="o">.</span><span class="n">signed_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">index</span>

                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  </body>
</html>